= Tourist Mobile Application — Solution Design
:toc: left
:toclevels: 3
:numbered:
:icons: font
:sectanchors:
:kroki-server-url: http://localhost:8000
:kroki-fetch-diagram: true

== Executive Summary

A mobile tourist application that uses AI-powered photo recognition to identify attractions and provide descriptions via text and audio. The platform connects tourists with signed partner businesses for monetization through commissions, advertising, and loyalty programs.

This document presents **3 architecture options** ranging from a lean MVP ($240k) to a full-featured platform ($1.65M), with a recommendation for **Option 2: Progressive Build** as the best balance of cost, risk, and feature delivery.

=== Key Decision: Why Option 2

[cols="1,3"]
|===
|Criteria |Rationale

|**Cost-effective**
|~$546k CAPEX covers POC through full features — 3× less than Option 3

|**Progressive de-risking**
|Validates core AI recognition in POC before committing to payments and loyalty

|**Monetization-ready**
|Stripe payments + loyalty program create revenue streams from Month 5+

|**Clear migration path**
|Modular monolith boundaries enable future microservices extraction and multi-region deployment when traffic demands it

|**Stable team**
|5 developers throughout — no mid-project hiring, no single points of failure
|===

---

== Problem Statement

=== Current User Pain Point

Tourists currently follow this flow to learn about attractions:

. Take a photo of an attraction
. Open ChatGPT or Wikipedia
. Manually search for information
. Read/listen separately
. Search again for nearby restaurants, cafes, activities

This is fragmented, slow, and has no monetization path.

=== Proposed Solution

A single mobile app that replaces the entire flow:

. User photographs an attraction
. AI identifies the attraction (95% target accuracy)
. App delivers a text + audio description
. App recommends signed partner businesses nearby
. User receives QR-code discounts at partners
. Loyalty program incentivizes repeat usage

=== Business Model

* **Partner commissions**: 10-20% on transactions facilitated through the app
* **Partner advertising**: Promoted placement in recommendation results
* **Scale ambition**: Klook/Viator level (50M+ users) over 3-5 years



== Architecture Options Overview

Three options are presented, each building on the previous:

[cols="1,2,1,1,1,1"]
|===
|Option |Description |CAPEX |OPEX/mo |Timeline |Regions

|**1: Validate**
|Core AI + partners, US only
|$240k
|$500
|4 months
|US

|**2: Validate + Monetize** ⭐
|MVP → Payments + Loyalty
|$546k
|$730
|~8 months
|US (China: Terraform-ready)

|**3: Full Platform**
|Complete platform, Day 1
|$1.65M
|$6,550
|10 months
|US + China + EU
|===



== Option 1: MVP — Validate the Core Concept

=== Overview

[cols="1,3"]
|===
|Timeline |4 months (Mar–Jun 2026)
|CAPEX |$240,000 (incl. 25% risk buffer)
|OPEX |$820/month (Year 1, ~1k users)
|Team |4 developers, 2 streams
|Region |US only (us-east-1)
|Architecture |Modular monolith + isolated AR microservice
|===

=== What It Delivers

* Photo recognition with multi-provider AI fallback (Google Vision → GPT-4V → Gemini)
* Attraction descriptions (text + audio via TTS)
* Partner recommendations based on geolocation (PostGIS)
* User accounts (Cognito — social login + email/password)
* QR code discount system
* Offline caching of visited attractions

=== What It Doesn't

* No payment processing
* No loyalty program
* No multi-region deployment
* No partner self-service portal
* No multi-language support

=== Architecture

.Option 1 Architecture Diagram
[plantuml,format=svg]
....
@startuml
title Option 1: MVP Architecture (US Only)

skinparam backgroundColor white
skinparam componentStyle rectangle
skinparam defaultTextAlignment center
skinparam rectangle {
  roundCorner 10
}
skinparam package {
  BackgroundColor #F8F9FA
  BorderColor #DEE2E6
}

actor "Mobile Users\n(iOS/Android)" as users
cloud "Route 53\nDNS" as dns
cloud "CloudFront CDN\nCache static content" as cdn

rectangle "AWS US-EAST-1 Region" as us #FAFAFA {
  component "Application LB\nHTTPS termination" as alb #ED7100

  package "Compute Layer" {
    package "Modular Monolith" #E8F5E9 {
      component "ECS: User Mgmt\nAuth & profiles" as ecs1 #FF9900
      component "ECS: Partner Mgmt\nBusiness profiles" as ecs2 #FF9900
      component "ECS: Recommendations\nGeo queries" as ecs3 #FF9900
    }
    package "AR Microservice" #E3F2FD {
      queue "SQS: Recognition Queue" as sqs #FF4F8B
      component "Lambda: Photo Recognition\nOn-demand scaling" as ar #FF9900
    }
  }

  package "Data Layer" #EDE7F6 {
    database "PostgreSQL Primary\nt4g.large, 100GB\nPostGIS" as db #3B48CC
    database "Redis Cache 5GB\nSessions & hot data" as cache #3B48CC
    storage "S3 Photos\nUser uploads" as s3p #3F8624
    storage "S3 Static Assets\nCDN origin" as s3s #3F8624
  }

  component "CloudWatch\nLogs, metrics, alerts" as cw #FF4F8B
  component "SES\nTransactional email" as email #FF4F8B
}

component "AWS Cognito\nOAuth 2.0/OIDC" as auth #DD344C

package "AI Services" #E8F5E9 {
  component "Google Vision API" as gv #4285F4
  component "OpenAI GPT-4V" as openai #00A67E
  component "Google Gemini (Fallback)" as gemini #4285F4
}

package "3rd Party" #FFF3E0 {
  component "Google Maps API" as maps #4285F4
}

component "Slack Alerts" as slack #611f69

users --> dns : HTTPS TLS 1.3
dns --> cdn
cdn --> alb
alb --> ecs1 : Route requests
alb --> auth : JWT validation

ecs1 --> s3p : Upload photo
s3p --> sqs : S3 event trigger
sqs --> ar : Process async
ar --> gv : 1. Landmark detect
ar --> openai : 2. Rich description
ar --> gemini : 3. Fallback

ecs1 --> db : ACID transactions
ecs1 --> cache : Hot data
ecs2 --> db : PostGIS geo queries
ecs2 --> cache : Cache popular results
ecs3 --> email : Notifications
ecs3 --> maps : POI data

ecs1 --> cw : Structured logs
ar --> cw : Execution logs
cw --> slack : Error rate >5%
cdn --> s3s : Cache origin
@enduml
....

Key components:

* **3 ECS Fargate tasks** — modular monolith with clear domain boundaries (Users, Partners, Content)
* **1 Lambda function** — AI photo recognition pipeline, decoupled via SQS
* **PostgreSQL** (db.t4g.large) with PostGIS for geolocation queries
* **Redis** (5GB) for session + hot data caching
* **S3** for photo storage
* **CloudFront CDN** for US distribution

=== Cost Breakdown

.Option 1 CAPEX
[cols="1,1,1,1,1,1,1", options="header"]
|===
|Phase |Duration |Team |Rate |Base Cost |Risk |Total

|POC
|2 months
|4 devs
|$600/day
|$96,000
|25%
|$120,000

|MVP
|2 months
|4 devs
|$600/day
|$96,000
|25%
|$120,000

6+|**Total CAPEX**
|**$240,000**
|===

.Option 1 Monthly OPEX
[cols="2,1,3", options="header"]
|===
|Service |Monthly Cost |Notes

|AWS ECS (Fargate)
|$180
|2 tasks, 0.5 vCPU / 1GB each

|RDS PostgreSQL
|$200
|db.t4g.large, 100GB, single-AZ

|ElastiCache Redis
|$75
|cache.t3.micro, 5GB

|S3 Storage
|$25
|Photos + static assets, ~50GB

|CloudFront CDN
|$50
|US distribution, ~100GB/mo

|Route 53
|$5
|DNS, health checks

|Lambda (AI)
|$30
|Photo recognition, ~5k invocations/mo

|SQS
|$5
|Recognition queue

|CloudWatch
|$30
|Logs, metrics, alarms

|Cognito
|$25
|~1,000 MAU (Year 1)

|OpenAI API
|$150
|GPT-4V, ~3k requests/mo

|Google Vision API
|$30
|Landmark detection, ~3k/mo

|SES
|$0
|Transactional emails, 62k/mo free from ECS

|Google Maps API
|$15
|Geocoding + Places, ~2k requests/mo

2+|**Total Monthly OPEX**
|**$820**
|===

=== Timeline

.Option 1 Development Timeline
[plantuml,format=svg]
....
@startgantt
title Option 1: MVP Timeline — 4 months, 4 devs, US only
printscale weekly zoom 2
project starts 2026-03-01

<style>
ganttDiagram {
  task {
    FontSize 11
  }
  milestone {
    FontSize 11
    FontStyle bold
    BackGroundColor OrangeRed
    LineColor OrangeRed
  }
  separator {
    FontSize 12
    FontStyle bold
    BackGroundColor #F0F0F0
  }
}
</style>

-- Backend (2 devs) --
[DB Schema + PostGIS Setup] starts 2026-03-01 and ends 2026-03-15
[DB Schema + PostGIS Setup] is colored in #BBDEFB/#1976D2
[Core API - Auth, Users] starts 2026-03-01 and ends 2026-03-25
[Core API - Auth, Users] is colored in #BBDEFB/#1976D2
[Photo Upload + S3 Integration] starts 2026-03-15 and ends 2026-04-01
[Photo Upload + S3 Integration] is colored in #BBDEFB/#1976D2
[AI Recognition Lambda] starts 2026-03-20 and ends 2026-04-15
[AI Recognition Lambda] is colored in #BBDEFB/#1976D2
[Partner API - CRUD, Geo queries] starts 2026-04-25 and ends 2026-05-20
[Partner API - CRUD, Geo queries] is colored in #C8E6C9/#388E3C
[Recommendation Engine] starts 2026-05-01 and ends 2026-05-25
[Recommendation Engine] is colored in #C8E6C9/#388E3C
[Redis Cache Layer] starts 2026-05-20 and ends 2026-06-05
[Redis Cache Layer] is colored in #C8E6C9/#388E3C

-- Mobile (2 devs) --
[Native iOS/Android Shell + Nav] starts 2026-03-01 and ends 2026-03-20
[Native iOS/Android Shell + Nav] is colored in #BBDEFB/#1976D2
[Camera + Photo Upload UI] starts 2026-03-15 and ends 2026-04-05
[Camera + Photo Upload UI] is colored in #BBDEFB/#1976D2
[Attraction Description Screen] starts 2026-03-25 and ends 2026-04-15
[Attraction Description Screen] is colored in #BBDEFB/#1976D2
[Partner Venues List + Details] starts 2026-04-25 and ends 2026-05-20
[Partner Venues List + Details] is colored in #C8E6C9/#388E3C
[QR Code Discount Generation] starts 2026-05-10 and ends 2026-05-30
[QR Code Discount Generation] is colored in #C8E6C9/#388E3C
[Audio Playback + TTS] starts 2026-05-15 and ends 2026-06-01
[Audio Playback + TTS] is colored in #C8E6C9/#388E3C

-- DevOps (shared) --
[CI/CD + Monitoring Setup] starts 2026-03-01 and ends 2026-03-25
[CI/CD + Monitoring Setup] is colored in #BBDEFB/#1976D2
[CloudWatch Alerts + Dashboards] starts 2026-05-15 and ends 2026-06-05
[CloudWatch Alerts + Dashboards] is colored in #C8E6C9/#388E3C

-- Integration --
[POC Integration + Testing] starts 2026-04-10 and ends 2026-04-25
[POC Integration + Testing] is colored in #BBDEFB/#1976D2
[MVP Integration + QA + App Store] starts 2026-06-01 and ends 2026-06-25
[MVP Integration + QA + App Store] is colored in #C8E6C9/#388E3C

[POC Demo] happens 2026-04-25
[MVP Launch] happens 2026-06-25

legend right
  |<#BBDEFB> POC Phase |
  |<#C8E6C9> MVP Phase |
  |<#OrangeRed> Milestone |
end legend
@endgantt
....

**Work Streams:**

[cols="1,1,3"]
|===
|Stream |Team |Focus

|Backend
|2 devs
|DB schema, APIs, photo upload pipeline, AI Lambda

|Mobile (Native)
|2 devs
|iOS (Swift) + Android (Kotlin) shells, camera, UI

|DevOps
|Shared
|CI/CD, CloudWatch, production setup
|===

=== Risk Assessment

Risk buffer: **25%** — justified by:

* Well-known AWS stack (ECS, PostgreSQL, S3)
* Single region — no multi-region complexity
* Clear, limited scope
* Team of 4 is manageable communication-wise



== Option 2: Validate + Monetize — RECOMMENDED ⭐

=== Overview

[cols="1,3"]
|===
|Timeline |~8 months (Mar–Oct 2026), MVP at Month 4
|CAPEX |$546,000 (incl. 25-35% risk buffer)
|OPEX |~$730/month (Year 1, ~1k users)
|Team |5 developers, stable throughout — 2 backend, 1 iOS, 1 Android, 1 mobile lead
|Regions |US (us-east-1). China: Terraform-ready, deployable in <1 day when needed
|Architecture |Modular monolith (single deployable) + Lambda for AI recognition
|===

NOTE: Developer rates assume mid-senior nearshore developers (Eastern Europe / Latin America). US-based teams would increase CAPEX by 40-60%.

=== What It Delivers (Beyond Option 1)

**Phase 1 — POC + MVP (Months 1-4):** Everything in Option 1, plus:

* US production deployment validated in POC

**Phase 2 — Full Features (Months 5-8):**

* **Stripe payment integration** for ticket/tour purchases
* **Loyalty points engine** — earn/redeem points, QR-based partner discounts
* **Multi-language support** — English, Chinese, Spanish
* **Partner self-service portal**
* **Offline mode** — cached content for previously visited attractions

**Deferred (deploy when business triggers are met):**

* **China region** — Terraform template ready. Deploy when first 10 Chinese partner businesses are signed.
* **On-device ML model** — Defer to Year 2+ when user base justifies the engineering investment. Offline cached content covers 90% of the use case.

=== Why This Option Is Recommended

. **Progressive de-risking**: POC validates AI + architecture before investing in payments and loyalty
. **Monetization-ready**: Stripe payments + loyalty program create revenue streams from Month 5+
. **Architecture migration path**: Modular monolith with clear boundaries enables future microservices extraction and multi-region deployment when traffic demands it
. **Stable team**: 5 devs throughout avoids mid-project hiring and onboarding disruption
. **China-ready, not China-deployed**: Terraform templates prepared during build, deployable in <1 day — satisfies the requirement to be "prepared to spin up" without paying for idle infrastructure

=== Architecture

.Option 2 Architecture Diagram
[plantuml,format=svg]
....
@startuml
title Option 2: Validate + Monetize - US (RECOMMENDED)

skinparam backgroundColor white
skinparam componentStyle rectangle
skinparam defaultTextAlignment center
skinparam rectangle {
  roundCorner 10
}
skinparam package {
  BackgroundColor #F8F9FA
  BorderColor #DEE2E6
}

actor "Mobile Users\n(iOS/Android)" as users
cloud "Route 53\nDNS" as dns
cloud "CloudFront CDN\nCache static content" as cdn

rectangle "AWS US-EAST-1 Region" as us_region #FAFAFA {
  component "ALB\nHTTPS termination" as alb #ED7100

  package "Compute Layer" {
    package "Modular Monolith (Single Deployable)" #E8F5E9 {
      component "ECS: Monolith\nUsers + Partners +\nRecommendations +\nPayments + Loyalty" as ecs_mono #FF9900
    }
    package "AI Recognition" #E3F2FD {
      queue "SQS: Recognition Queue" as sqs #FF4F8B
      component "Lambda: Photo Recognition\nOn-demand scaling" as ar #FF9900
    }
  }

  package "Data Layer" #EDE7F6 {
    database "PostgreSQL\nt4g.medium, 100GB\nMulti-AZ, PostGIS" as db #3B48CC
    database "Redis Cache 5GB\nSessions & hot data" as cache #3B48CC
    storage "S3 Photos\nUser uploads" as s3p #3F8624
    storage "S3 Static Assets\nCDN origin" as s3s #3F8624
  }

  component "CloudWatch\nLogs, metrics, alerts" as cw #FF4F8B
  component "SES\nTransactional email" as email #FF4F8B
}

component "AWS Cognito\nOAuth 2.0/OIDC" as auth #DD344C

package "AI Services" #E8F5E9 {
  component "Google Vision API" as gv #4285F4
  component "OpenAI GPT-4V" as openai #00A67E
  component "Google Gemini (Fallback)" as gemini #4285F4
}

package "3rd Party" #FFF3E0 {
  component "Stripe" as stripe #635BFF
  component "Google Maps API" as maps #4285F4
}

component "Slack Alerts" as slack #611f69

users --> dns : HTTPS TLS 1.3
dns --> cdn
cdn --> alb
alb --> ecs_mono : Route requests
alb --> auth : JWT validation

ecs_mono --> s3p : Upload photo
s3p --> sqs : S3 event trigger
sqs --> ar : Process async
ar --> gv : 1. Landmark detect
ar --> openai : 2. Rich description
ar --> gemini : 3. Fallback

ecs_mono --> db : ACID transactions
ecs_mono --> cache : Hot data
ecs_mono --> stripe : Payments (Phase 2)

ecs_mono --> email : Notifications
ecs_mono --> maps : POI data

ecs_mono --> cw : Structured logs
ar --> cw : Execution logs
cw --> slack : Error rate >5%
cdn --> s3s : Cache origin
@enduml
....

Key components:

* **1 ECS Fargate task** — true modular monolith with internal module boundaries (Users, Partners, Recommendations, Payments, Loyalty) deployed as a single unit
* **1 Lambda function** — AI photo recognition pipeline, decoupled via SQS for independent scaling
* **PostgreSQL** (db.t4g.medium, Multi-AZ) with PostGIS for geolocation queries
* **Redis** (5GB) for session + hot data caching
* **S3** for photo storage
* **CloudFront CDN** for US distribution
* **SQS** for async photo processing — the only messaging service needed at this scale

**Scaling triggers:**

* Add **read replica** when p95 query latency exceeds 200ms
* Add **China region** (from Terraform template) when first 10 Chinese partners are signed
* Add **EventBridge/SNS** when a single event needs to fan out to multiple consumers
* Extract modules to **separate services** when team grows beyond one team boundary

=== Cost Breakdown

.Option 2 CAPEX
[cols="1,1,1,1,1,1,1", options="header"]
|===
|Phase |Duration |Team |Rate |Base Cost |Risk |Total

|POC
|2 months
|5 devs
|$600/day
|$120,000
|25%
|$150,000

|MVP
|2 months
|5 devs
|$600/day
|$120,000
|25%
|$150,000

|Full
|3 months
|5 devs
|$600/day
|$180,000
|35%
|$243,000

6+|**Total CAPEX**
|**$543,000**
|===

.Option 2 Monthly OPEX
[cols="2,1,3", options="header"]
|===
|Service |Monthly Cost |Notes

|AWS ECS (Fargate)
|$150
|1 task, 1 vCPU / 2GB (monolith)

|RDS PostgreSQL
|$200
|db.t4g.medium, 100GB, Multi-AZ

|ElastiCache Redis
|$50
|cache.t3.micro, 5GB

|S3 Storage
|$25
|Photos + static assets, ~100GB

|CloudFront CDN
|$50
|US distribution, ~100GB/mo

|Route 53
|$5
|DNS, health checks

|Lambda (AI)
|$5
|Photo recognition, ~10k invocations/mo

|SQS
|$5
|Recognition queue

|CloudWatch
|$30
|Logs, metrics, alarms

|Cognito
|$0
|Free tier covers up to 50k MAU

|OpenAI API
|$200
|GPT-4V, ~8k requests/mo

|Google Vision API
|$15
|~8k requests/mo (1k free)

|Stripe Processing
|$50
|2.9% + $0.30 per transaction (low initial volume)

|SES
|$0
|62k emails/mo free when sent from ECS

|Google Maps API
|$0
|$200/mo free credit covers ~5k requests/mo

2+|**Total Monthly OPEX**
|**~$785**
|===

NOTE: OPEX estimates reflect realistic Year 1 costs at ~1,000 users. Costs scale with usage — at 10k users (Year 2), expect ~$1,500-2,000/mo. Free tier credits excluded where they expire or usage exceeds thresholds.

.Year 1 Total Cost of Ownership
[cols="2,1,3", options="header"]
|===
|Category |Cost |Notes

|CAPEX (development)
|$543,000
|5 devs × ~8 months, incl. risk buffer

|Infrastructure OPEX (12 months)
|~$9,400
|~$785/mo × 12

|Team cost post-build (4 months maintenance)
|$240,000
|5 devs × $600/day × 20 days × 4 months (assuming team retained for iteration)

2+|**Year 1 Total**
|**~$792,000**
|===

NOTE: Team cost post-build assumes the full team is retained for maintenance, iteration, and feature refinement after the 8-month build phase. If team is reduced, this cost decreases proportionally.

**Cost rationale:**

* POC: 5 devs × 2 months × $600/day = $120,000 base + 25% risk = $150,000
* MVP: 5 devs × 2 months × $600/day = $120,000 base + 25% risk = $150,000
* Full: 5 devs × 3 months × $600/day = $180,000 base + 35% risk = $243,000
* **Total: $543,000**
* Higher risk buffer (35%) on Full phase due to: Stripe integration complexity, loyalty program edge cases, multi-language content pipeline

=== Timeline

.Option 2 Development Timeline
[plantuml,format=svg]
....
@startgantt
title Option 2: Validate + Monetize — ~8 months, 5 devs, US (RECOMMENDED)
printscale weekly zoom 2
project starts 2026-03-01

<style>
ganttDiagram {
  task {
    FontSize 11
  }
  milestone {
    FontSize 11
    FontStyle bold
    BackGroundColor OrangeRed
    LineColor OrangeRed
  }
  separator {
    FontSize 12
    FontStyle bold
    BackGroundColor #F0F0F0
  }
}
</style>

-- Backend (2 devs) --
[DB Schema + PostGIS + Migrations] starts 2026-03-01 and ends 2026-03-15
[DB Schema + PostGIS + Migrations] is colored in #BBDEFB/#1976D2
[Core API - Auth, Users, Profiles] starts 2026-03-01 and ends 2026-03-28
[Core API - Auth, Users, Profiles] is colored in #BBDEFB/#1976D2
[Photo Upload + SQS + S3 Pipeline] starts 2026-03-15 and ends 2026-04-05
[Photo Upload + SQS + S3 Pipeline] is colored in #BBDEFB/#1976D2
[AI Recognition Lambda - Multi-LLM] starts 2026-03-20 and ends 2026-04-20
[AI Recognition Lambda - Multi-LLM] is colored in #BBDEFB/#1976D2
[Partner CRUD + Geo Queries API] starts 2026-05-15 and ends 2026-06-08
[Partner CRUD + Geo Queries API] is colored in #C8E6C9/#388E3C
[Recommendation Engine + Cache] starts 2026-05-25 and ends 2026-06-20
[Recommendation Engine + Cache] is colored in #C8E6C9/#388E3C
[QR Code Discount System] starts 2026-06-10 and ends 2026-06-30
[QR Code Discount System] is colored in #C8E6C9/#388E3C
[Stripe Payment Integration] starts 2026-07-20 and ends 2026-08-18
[Stripe Payment Integration] is colored in #FFE0B2/#E65100
[Loyalty Points Engine] starts 2026-08-01 and ends 2026-09-01
[Loyalty Points Engine] is colored in #FFE0B2/#E65100
[Partner Portal API] starts 2026-08-15 and ends 2026-09-10
[Partner Portal API] is colored in #FFE0B2/#E65100

-- iOS (1 dev) --
[iOS Shell + Navigation] starts 2026-03-01 and ends 2026-03-20
[iOS Shell + Navigation] is colored in #BBDEFB/#1976D2
[iOS Camera + Photo Upload] starts 2026-03-15 and ends 2026-04-05
[iOS Camera + Photo Upload] is colored in #BBDEFB/#1976D2
[iOS Attraction Description + TTS] starts 2026-03-25 and ends 2026-04-20
[iOS Attraction Description + TTS] is colored in #BBDEFB/#1976D2
[iOS Partner Venues + Map View] starts 2026-05-15 and ends 2026-06-08
[iOS Partner Venues + Map View] is colored in #C8E6C9/#388E3C
[iOS QR Code + Discount] starts 2026-06-01 and ends 2026-06-20
[iOS QR Code + Discount] is colored in #C8E6C9/#388E3C
[iOS Offline Cache] starts 2026-06-15 and ends 2026-07-05
[iOS Offline Cache] is colored in #C8E6C9/#388E3C
[iOS Payment + Checkout] starts 2026-07-20 and ends 2026-08-15
[iOS Payment + Checkout] is colored in #FFE0B2/#E65100
[iOS Loyalty Dashboard] starts 2026-08-10 and ends 2026-09-01
[iOS Loyalty Dashboard] is colored in #FFE0B2/#E65100

-- Android (1 dev + mobile lead support) --
[Android Shell + Navigation] starts 2026-03-01 and ends 2026-03-20
[Android Shell + Navigation] is colored in #BBDEFB/#1976D2
[Android Camera + Photo Upload] starts 2026-03-15 and ends 2026-04-05
[Android Camera + Photo Upload] is colored in #BBDEFB/#1976D2
[Android Attraction Description + TTS] starts 2026-03-25 and ends 2026-04-20
[Android Attraction Description + TTS] is colored in #BBDEFB/#1976D2
[Android Partner Venues + Map View] starts 2026-05-15 and ends 2026-06-08
[Android Partner Venues + Map View] is colored in #C8E6C9/#388E3C
[Android QR Code + Discount] starts 2026-06-01 and ends 2026-06-20
[Android QR Code + Discount] is colored in #C8E6C9/#388E3C
[Android Offline Cache] starts 2026-06-15 and ends 2026-07-05
[Android Offline Cache] is colored in #C8E6C9/#388E3C
[Android Payment + Checkout] starts 2026-07-20 and ends 2026-08-15
[Android Payment + Checkout] is colored in #FFE0B2/#E65100
[Android Loyalty Dashboard] starts 2026-08-10 and ends 2026-09-01
[Android Loyalty Dashboard] is colored in #FFE0B2/#E65100

-- Mobile Lead (shared across iOS/Android) --
[Cross-platform Architecture + API Contracts] starts 2026-03-01 and ends 2026-03-20
[Cross-platform Architecture + API Contracts] is colored in #BBDEFB/#1976D2
[Code Reviews + Integration Testing] starts 2026-03-20 and ends 2026-04-20
[Code Reviews + Integration Testing] is colored in #BBDEFB/#1976D2
[Multi-language Support] starts 2026-08-20 and ends 2026-09-15
[Multi-language Support] is colored in #FFE0B2/#E65100
[China Terraform Templates] starts 2026-09-01 and ends 2026-09-15
[China Terraform Templates] is colored in #FFE0B2/#E65100

-- DevOps (shared) --
[CI/CD + IaC - Terraform] starts 2026-03-01 and ends 2026-03-28
[CI/CD + IaC - Terraform] is colored in #BBDEFB/#1976D2
[US Region Prod Setup] starts 2026-05-25 and ends 2026-06-15
[US Region Prod Setup] is colored in #C8E6C9/#388E3C

-- Integration & QA --
[POC Integration Sprint] starts 2026-04-15 and ends 2026-04-30
[POC Integration Sprint] is colored in #BBDEFB/#1976D2
[Phase buffer] starts 2026-05-01 and ends 2026-05-14
[Phase buffer] is colored in #E0E0E0/#9E9E9E
[MVP Integration + QA] starts 2026-07-01 and ends 2026-07-15
[MVP Integration + QA] is colored in #C8E6C9/#388E3C
[Phase buffer] starts 2026-07-15 and ends 2026-07-20
[Phase buffer] is colored in #E0E0E0/#9E9E9E
[Full Release QA + Regression] starts 2026-09-15 and ends 2026-10-05
[Full Release QA + Regression] is colored in #FFE0B2/#E65100
[App Store Review (iOS + Android)] starts 2026-10-06 and ends 2026-10-20
[App Store Review (iOS + Android)] is colored in #FFE0B2/#E65100

[POC Demo] happens 2026-04-30
[MVP Launch - US] happens 2026-07-15
[Full Release] happens 2026-10-20

legend right
  |<#BBDEFB> POC Phase |
  |<#C8E6C9> MVP Phase |
  |<#E0E0E0> Phase Buffer |
  |<#FFE0B2> Full Phase |
  |<#OrangeRed> Milestone |
end legend
@endgantt
....

**Work Streams:**

[cols="1,1,1,3"]
|===
|Stream |Phase |Team |Focus

|Backend
|POC→Full
|2 devs
|DB schema + PostGIS, core APIs, photo pipeline, AI Lambda, payment integration, loyalty engine, partner portal

|iOS
|POC→Full
|1 dev
|Swift: camera, partner UI, payments, offline cache, loyalty dashboard

|Android
|POC→Full
|1 dev
|Kotlin: camera, partner UI, payments, offline cache, loyalty dashboard

|Mobile Lead
|POC→Full
|1 dev (shared)
|Cross-platform architecture, API contracts, code reviews for both platforms, multi-language, China Terraform templates, QA coordination

|DevOps
|POC→MVP
|Shared
|CI/CD (Terraform), US prod setup, monitoring
|===

NOTE: The mobile lead eliminates single points of failure on each platform by providing code review capability and fill-in capacity. This role also handles cross-cutting concerns (multi-language, App Store submissions) that don't belong to a single platform.

=== Key Milestones

[cols="1,1,3"]
|===
|Milestone |Date |Gate Criteria

|**POC Demo**
|Apr 30, 2026
|AI recognition ≥90% accuracy, end-to-end photo→description flow working, <3s latency

|**MVP Launch (US)**
|Jul 15, 2026
|App Store submission, partner ecosystem with ≥10 partners, QR discounts functional

|**Full Release**
|Oct 20, 2026
|Payments live, loyalty program active, multi-language support, App Store approved
|===

=== Risk Assessment

Risk buffer: **25% (POC/MVP) → 35% (Full)** — justified by:

* POC/MVP: Well-known AWS stack (ECS, PostgreSQL, S3), single region, clear scope → 25%
* Full phase 35% because:
** Stripe integration has edge cases in payment flows, refunds, and webhook reliability
** Loyalty points engine requires careful reconciliation logic
** Multi-language content pipeline needs TTS in multiple languages
** App Store review process can require multiple submission cycles



== Option 3: All Features Day 1

=== Overview

[cols="1,3"]
|===
|Timeline |10 months (Mar–Dec 2026)
|CAPEX |$1,654,000 (incl. 30-40% risk buffer)
|OPEX |$6,550/month (Year 2, ~50k users)
|Team |8→10 developers, 4 streams
|Regions |US + China active, EU prepared
|Architecture |Full microservices (5 ECS services) + polyglot persistence
|===

=== What It Adds Beyond Option 2

* **True microservices**: 5 independent ECS services (User, Partner, Recommendation, Payment, Loyalty)
* **API Gateway** as front door with throttling, rate limiting
* **OpenSearch** cluster for geo + full-text search
* **DynamoDB** for AR time-series logs
* **Kinesis + Redshift** analytics pipeline
* **WAF** for DDoS protection
* **KMS** encryption (AES-256) for data at rest
* **EU region** infrastructure prepared (not active)
* **Google Translate** for real-time multi-language

=== Architecture

Option 3 extends Option 2's architecture with microservices decomposition (3 separate ECS tasks), active China + EU regions, OpenSearch, Kinesis analytics pipeline, and EventBridge event mesh. Detailed architecture diagram available on request.

=== Cost Breakdown

.Option 3 CAPEX
[cols="1,1,1,1,1,1,1", options="header"]
|===
|Phase |Duration |Team |Rate |Base Cost |Risk |Total

|POC
|3 months
|8 devs
|$650/day
|$312,000
|30%
|$405,600

|MVP
|4 months
|10 devs
|$650/day
|$520,000
|35%
|$702,000

|Full
|3 months
|10 devs
|$650/day
|$390,000
|40%
|$546,000

6+|**Total CAPEX**
|**$1,653,600**
|===

.Option 3 Monthly OPEX
[cols="2,1,3", options="header"]
|===
|Service |Monthly Cost |Notes

|ECS/Fargate (5 services × 3 regions)
|$1,200
|Microservices across US, CN, EU

|RDS Aurora (3 regions)
|$1,500
|db.r6g.2xlarge, 1TB+, Multi-AZ each

|ElastiCache Redis Cluster
|$400
|20GB+, HA mode, 3 regions

|DynamoDB (AR logs)
|$100
|Time-series, on-demand capacity

|OpenSearch Cluster
|$350
|3-node cluster, geo search

|S3 Storage (Global)
|$100
|~500GB across regions

|CloudFront + Alibaba CDN
|$250
|Global + China CDN

|Lambda (AI Workers)
|$120
|~25k invocations/mo

|Kinesis + Redshift
|$500
|Analytics pipeline + data warehouse

|EventBridge + SQS + SNS
|$50
|Event mesh + messaging

|CloudWatch + X-Ray
|$150
|Full observability, 3 regions

|WAF + Shield
|$100
|DDoS protection, bot mitigation

|Cognito + KMS
|$80
|MFA, encryption, ~50k MAU

|OpenAI API
|$800
|GPT-4V, ~25k requests/mo

|Google Vision + Gemini
|$200
|Multi-model fallback

|Stripe Processing
|$500
|Higher volume transactions

|Google Maps + Translate
|$100
|POI + translation, ~20k/mo

|SES + SNS Push
|$50
|Email + push notifications

2+|**Total Monthly OPEX**
|**$6,550**
|===

=== Timeline

10 months with 8→10 devs across 4 streams (Backend Core, Mobile, DevOps, Multi-Region). Detailed Gantt chart available on request.

=== Trade-offs vs Option 2

[cols="1,1,1"]
|===
|Aspect |Advantage |Disadvantage

|Microservices
|Independent scaling, team autonomy
|3× more infrastructure, DevOps complexity

|Full analytics
|Business insights from Day 1
|Kinesis + Redshift = $500/mo before usage

|3 regions
|EU compliance ready
|EU region idle until traffic justifies it

|Larger team
|Faster parallel development
|More coordination overhead (30% vs 25%)
|===

=== Risk Assessment

Risk buffer: **30-40%** — justified by:

* Full microservices from Day 1 without incremental validation
* 3 simultaneous regions increase blast radius
* 10-person team coordination overhead
* Payment + loyalty + analytics all in parallel introduce multiple external vendor dependencies



== Scaling Path (Future)

This section is **not an option to choose now** — it describes the migration path if the product outgrows Options 2 or 3.

When the modular monolith reaches its limits, the architecture evolves toward:

* **EKS + Istio** service mesh — decompose modules into independent services
* **Aurora Global DB** — sharding, cross-region replication
* **Kafka** for high-throughput event streaming (replacing SQS at scale)
* **Multi-region active-active** deployment (US, China, EU)
* **SageMaker** for custom ML model training

=== Trigger Conditions

This migration makes sense only when:

* Active users exceed **100k+** and growing
* Database queries hit performance limits despite indexing and read replicas
* Monthly revenue justifies **$50k+/mo** infrastructure spend
* Team has grown to **15+** and needs microservices team boundaries
* Business requires multi-region active-active presence

Detailed architecture and cost breakdown available on request once trigger conditions are met.



== Technical Deep Dives

=== AI Recognition Strategy

The AI pipeline uses a multi-provider fallback chain to achieve 95% accuracy:

----
User uploads photo
    ↓
Google Vision API (Fast landmark detection, ~200ms)
    ↓ Found landmark?
    ├── Yes → OpenAI GPT-4V (Rich description generation)
    │         ↓ Failed?
    │         └── Google Gemini (Fallback LLM)
    ├── No landmark → Gemini general description
    └── Offline → On-device ML model (70-80% accuracy)
    ↓
Result cached in Redis (24h TTL) → S3 (permanent archive)
----

**Why multi-provider:**

* No single AI provider is 100% reliable or available in all regions
* Google Vision excels at landmark detection (fast, cheap)
* GPT-4V generates the richest natural-language descriptions
* Gemini serves as fallback and primary provider in China (where OpenAI may be blocked)
* On-device ML enables offline mode and reduces cloud API costs

**Cost optimization:**

* Redis caching avoids re-processing the same attraction photos
* SQS decouples the upload from recognition (async processing)
* Lambda pricing = pay only for actual recognition invocations

=== Mobile Strategy: Native (Swift + Kotlin)

**Decision:** Native iOS (Swift) + Android (Kotlin) over React Native

**Rationale:**

[cols="1,2,2"]
|===
|Factor |Native (Swift/Kotlin) |React Native

|**Camera performance**
|Direct hardware access, zero overhead
|Bridge overhead for camera-intensive operations

|**Offline ML**
|CoreML (iOS) + TensorFlow Lite (Android) native integration
|Requires native module bridges

|**AR capabilities**
|ARKit (iOS) + ARCore (Android) first-class support
|Community packages with lag behind platform updates

|**App size**
|Smaller binary
|JS bundle + bridge overhead

|**Team investment**
|Requires iOS + Android expertise
|Single codebase but bridge debugging is complex
|===

Photography is the core user action — native camera performance is a non-negotiable requirement for user experience.

=== Database Strategy

**Primary: PostgreSQL + PostGIS**

* ACID compliance for payment transactions
* PostGIS for geolocation queries (attractions near user, partners near attraction)
* JSONB columns for flexible attraction metadata (different attributes per attraction type)
* Read replicas for search-heavy workloads (Option 2+)

**Scaling path:**

[cols="1,1,3"]
|===
|Scale Level |Database |Strategy

|0-10k users
|Single PostgreSQL
|Proper indexing + query optimization. PostGIS spatial indexes

|10k-100k users
|PostgreSQL + Read Replicas
|Separate read/write paths. ElastiCache for session + hot data

|100k-1M users
|Aurora PostgreSQL
|Auto-scaling storage + read replicas. Connection pooling (PgBouncer)

|1M+ users
|Aurora Global DB (Sharded)
|Horizontal sharding by region. 10+ shards, 50+ replicas
|===

=== Multi-Region Strategy

**US + China from Option 2+:**

[cols="1,2,2"]
|===
|Aspect |US (us-east-1) |China (cn-north-1)

|Compute
|ECS Fargate
|ECS Fargate (AWS China)

|Database
|PostgreSQL Primary + Replica
|PostgreSQL Standalone

|CDN
|CloudFront
|Alibaba Cloud CDN (GFW compliant)

|AI Primary
|OpenAI GPT-4V
|Google Gemini (OpenAI blocked in China)

|Replication
|Source
|Async replication target (RPO 15 min)

|Data residency
|US data stays in US
|China user data stays in China (regulation)
|===

**Key constraint:** China data residency laws require personal data of Chinese users to remain within mainland China. This means separate database instances, not just read replicas.

=== Security Architecture

[cols="1,2,2"]
|===
|Layer |Implementation |Options

|**Authentication**
|AWS Cognito (OAuth 2.0 / OIDC)
|Social login + email/password. MFA in Option 3+

|**Transport**
|TLS 1.3 enforced
|All options

|**Data at rest**
|AES-256 encryption
|KMS in Option 3+

|**API protection**
|Rate limiting + throttling
|API Gateway in Option 3+, ALB rules in Option 1-2

|**DDoS protection**
|CloudFront + WAF
|WAF in Option 3, Shield Advanced available as scaling path upgrade

|**Payment security**
|Stripe (PCI-DSS compliant)
|Tokenized — no raw card data in our systems
|===



== Cost Estimation Methodology

=== Approach

Costs are estimated using **developer-price × time**, not per-module:

* **Rate:** $600/day for mid-level developers
* **Working days:** 20 per month
* **Non-coding overhead:** 25-30% baked into timeline (code reviews, testing, documentation, standups)
* **Risk buffer:** 25-45% per phase, justified for each option
* **Bus factor:** Minimum 2 developers per stream

=== Risk Buffer Justification

[cols="1,1,3"]
|===
|Option |Risk % |Justification

|Option 1
|25%
|Well-known AWS stack, single region, clear scope, small team

|Option 2
|25-35%
|POC/MVP same as Option 1 (25%). Full phase adds Stripe PCI, partner integrations (35%)

|Option 3
|30-40%
|Full microservices from Day 1, 3 simultaneous regions, 10-person team coordination, multiple vendor integrations
|===

=== CAPEX Summary

.Cost Comparison Chart
[cols="2,1,1,1,1", options="header"]
|===
|Option |CAPEX |OPEX/mo |Timeline |Team

|**1: Validate**
|$240,000
|$820
|4 months
|4 devs

|**2: Validate + Monetize** ⭐
|$543,000
|~$785
|~8 months
|5 devs

|**3: Full Platform**
|$1,653,600
|$6,550
|10 months
|8→10 devs
|===



== Assumptions & Constraints

=== Assumptions

. **Budget was not discussed** — we assume a Year 1 investment capacity of **$500k–$600k** (CAPEX + team + OPEX). Option 2 fits within this range at ~$792k TCO including team costs. _If the actual budget is materially different, prioritization may change._

. **The application will be popular** — therefore we need an architecture that can scale. The progressive approach (Option 2) validates before investing in scale infrastructure.

. **Offline mode is essential for tourists** — areas like mountain vineyards may have poor connectivity. On-device ML is deferred to the Full phase to reduce initial complexity. Basic offline caching of previously viewed content is included in MVP.

. **US is the priority market** — we deploy to US only. China infrastructure is Terraform-ready but not deployed until business triggers justify it (first Chinese attraction partner signed).

. **Partner onboarding is manual initially** — the client team signs partners and enters their information. A self-service partner portal comes in Phase 2 (Full).

. **No real-time AR overlays** — the flow is: take photo → get description. Not: point camera → see live overlays. This significantly reduces mobile complexity.

. **Team of 5 developers** — stable throughout the project. No mid-project scaling. See <<Team Structure>> for role breakdown.

. **Risk buffer of 20-50%** — applied per phase based on complexity. AI integration and dual-platform native mobile carry the highest uncertainty.

=== Constraints

* **China data residency:** When China is deployed, personal data of Chinese users must remain in mainland China (Cybersecurity Law). Infrastructure is Terraform-ready.
* **PCI-DSS compliance:** Payment card data must be tokenized through Stripe — never stored in our systems
* **GDPR readiness:** Data collection, consent, and right-to-erasure mechanisms designed from Day 1
* **AI API availability:** OpenAI may be blocked or restricted in China — Gemini serves as primary provider there
* **App Store approval:** Both Apple App Store and Google Play require review cycles (1-2 weeks each). Timeline includes a 2-week review block.



== Recommended Next Steps

. **Approve Option 2** as the implementation approach (~$543k CAPEX, ~$785/mo OPEX)
. **Confirm technology stack** — FastAPI (Python) backend, Swift (iOS) + Kotlin (Android) native
. **Confirm team structure** — 5 developers, stable throughout the project (2 Backend, 1 iOS, 1 Android, 1 Mobile Lead)
. **Confirm budget range** — Year 1 TCO ~$792k (CAPEX + team + OPEX)
. **Week 1:** Requirements refinement + design sprints
. **Week 2:** Infrastructure setup (AWS, CI/CD, databases)
. **Week 3:** Sprint 1 begins (Backend APIs + Mobile shell)
. **POC Demo:** May 15, 2026
. **MVP Launch:** July 15, 2026 (after App Store review)
. **Full Release:** October 20, 2026



== Appendix: Artifact Inventory

=== Architecture Diagrams (3 options — inline PlantUML via Kroki)

* Option 1 — Modular monolith, US only
* Option 2 — Progressive build, US only, China Terraform-ready (RECOMMENDED)
* Option 3 — Full platform, US + China + EU
* Scaling Path — migration triggers for future growth

=== Timeline Gantt Charts (inline PlantUML via Kroki)

* Option 1 — 4 months, 4 devs, 2 streams
* Option 2 — ~8 months, 5 devs, 3 streams (iOS, Android, Backend)
* Option 3 — overview only (10 months, 8→10 devs)

=== Cost Analysis (inline AsciiDoc tables)

* CAPEX breakdown per phase (3 options)
* Monthly OPEX line items (3 options)
* Year 1 TCO summary (Option 2)
* Cost comparison summary table

=== Related Documents

* `questionnaire/architecture-questionnaire-short.md` — Client-facing summary
* `questionnaire/architecture-questionnaire.md` — Full internal questionnaire (10 sections)
* `docs/user-stories.adoc` — Epic-based user stories with acceptance criteria
* `assignment/meeting-1.adoc` — Assignment brief and requirements
* `assignment/key-informations.md` — Client requirements notes
* `assignment/notes` — Internal feedback
