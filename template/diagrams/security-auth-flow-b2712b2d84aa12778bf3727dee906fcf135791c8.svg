<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="826px" preserveAspectRatio="none" style="width:863px;height:826px;background:#FFFFFF;" version="1.1" viewBox="0 0 863 826" width="863px" zoomAndPan="magnify"><title>Authentication Flow &#8212; OAuth2 / OIDC</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="295.7432" x="284.6555" y="27.9951">Authentication Flow &#8212; OAuth2 / OIDC</text><rect fill="none" height="395.6641" style="stroke:#000000;stroke-width:1.5;" width="846.0542" x="10" y="252.125"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="User" id="part1-lifeline"><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="34.9551" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="38" x2="38" y1="118.5938" y2="745.3203"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="app" id="part2-lifeline"><g><title>Client App</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="141.3223" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="145.1567" x2="145.1567" y1="118.5938" y2="745.3203"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="gw" id="part3-lifeline"><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="343.3994" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="347.1777" x2="347.1777" y1="118.5938" y2="745.3203"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="idp" id="part4-lifeline"><g><title>Identity Provider</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="505.2109" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="509.061" x2="509.061" y1="118.5938" y2="745.3203"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="api" id="part5-lifeline"><g><title>API Server</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="623.6152" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="627.3608" x2="627.3608" y1="118.5938" y2="745.3203"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="db" id="part6-lifeline"><g><title>User Store</title><rect fill="#000000" fill-opacity="0.00000" height="626.7266" width="8" x="802.2188" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="805.3833" x2="805.3833" y1="118.5938" y2="745.3203"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="User" id="part1-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="20" y="115.292">User</text><ellipse cx="38.9551" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.9551,58.7969 L38.9551,85.7969 M25.9551,66.7969 L51.9551,66.7969 M38.9551,85.7969 L25.9551,100.7969 M38.9551,85.7969 L51.9551,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="User" id="part1-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="20" y="757.3154">User</text><ellipse cx="38.9551" cy="769.1172" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.9551,777.1172 L38.9551,804.1172 M25.9551,785.1172 L51.9551,785.1172 M38.9551,804.1172 L25.9551,819.1172 M38.9551,804.1172 L51.9551,819.1172" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="app" id="part2-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.3311" x="102.1567" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.3311" x="109.1567" y="107.292">Client App</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="app" id="part2-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.3311" x="102.1567" y="744.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.3311" x="109.1567" y="764.3154">Client App</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="gw" id="part3-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="296.1777" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="303.1777" y="107.292">API Gateway</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="gw" id="part3-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="296.1777" y="744.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="303.1777" y="764.3154">API Gateway</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="idp" id="part4-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.2998" x="444.061" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.2998" x="451.061" y="107.292">Identity Provider</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="idp" id="part4-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.2998" x="444.061" y="744.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.2998" x="451.061" y="764.3154">Identity Provider</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="api" id="part5-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.5088" x="584.3608" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.5088" x="591.3608" y="107.292">API Server</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="api" id="part5-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.5088" x="584.3608" y="744.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.5088" x="591.3608" y="764.3154">API Server</text></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="db" id="part6-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6709" x="766.3833" y="115.292">User Store</text><path d="M788.2188,66.2969 C788.2188,56.2969 806.2188,56.2969 806.2188,56.2969 C806.2188,56.2969 824.2188,56.2969 824.2188,66.2969 L824.2188,92.2969 C824.2188,102.2969 806.2188,102.2969 806.2188,102.2969 C806.2188,102.2969 788.2188,102.2969 788.2188,92.2969 L788.2188,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M788.2188,66.2969 C788.2188,76.2969 806.2188,76.2969 806.2188,76.2969 C806.2188,76.2969 824.2188,76.2969 824.2188,66.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="db" id="part6-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6709" x="766.3833" y="757.3154">User Store</text><path d="M788.2188,770.6172 C788.2188,760.6172 806.2188,760.6172 806.2188,760.6172 C806.2188,760.6172 824.2188,760.6172 824.2188,770.6172 L824.2188,796.6172 C824.2188,806.6172 806.2188,806.6172 806.2188,806.6172 C806.2188,806.6172 788.2188,806.6172 788.2188,796.6172 L788.2188,770.6172" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M788.2188,770.6172 C788.2188,780.6172 806.2188,780.6172 806.2188,780.6172 C806.2188,780.6172 824.2188,780.6172 824.2188,770.6172" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="133.3223,145.7266,143.3223,149.7266,133.3223,153.7266,137.3223,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="38.9551" x2="139.3223" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.3672" x="50.9551" y="144.6606">Click "Login"</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg2"><polygon fill="#181818" points="497.2109,174.8594,507.2109,178.8594,497.2109,182.8594,501.2109,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="145.3223" x2="503.2109" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.4512" x="256.541" y="173.7935">Redirect to /authorize</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg3"><polygon fill="#181818" points="49.9551,203.9922,39.9551,207.9922,49.9551,211.9922,45.9551,207.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43.9551" x2="508.2109" y1="207.9922" y2="207.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.4785" x="220.3438" y="202.9263">Show login page</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg4"><polygon fill="#181818" points="497.2109,233.125,507.2109,237.125,497.2109,241.125,501.2109,237.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="38.9551" x2="503.2109" y1="237.125" y2="237.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.0649" x="218.5505" y="232.0591">Enter credentials</text></g><path d="M10,252.125 L74.4429,252.125 L74.4429,259.2578 L64.4429,269.2578 L10,269.2578 L10,252.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="395.6641" style="stroke:#000000;stroke-width:1.5;" width="846.0542" x="10" y="252.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="265.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.7856" x="89.4429" y="264.3354">[Credentials valid]</text><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg5"><polygon fill="#181818" points="156.3223,286.3906,146.3223,290.3906,156.3223,294.3906,152.3223,290.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="150.3223" x2="508.2109" y1="290.3906" y2="290.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.624" x="233.4546" y="285.3247">Authorization code (redirect)</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg6"><polygon fill="#181818" points="497.2109,330.6563,507.2109,334.6563,497.2109,338.6563,501.2109,334.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="145.3223" x2="503.2109" y1="334.6563" y2="334.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9619" x="242.7856" y="314.4575">Exchange code for tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.9341" x="244.2996" y="329.5903">(client_id + client_secret)</text></g><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg7"><polygon fill="#181818" points="156.3223,359.7891,146.3223,363.7891,156.3223,367.7891,152.3223,363.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="150.3223" x2="508.2109" y1="363.7891" y2="363.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.6992" x="192.417" y="358.7231">Access token + Refresh token + ID token</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg8"><polygon fill="#181818" points="335.3994,388.9219,345.3994,392.9219,335.3994,396.9219,339.3994,392.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="145.3223" x2="341.3994" y1="392.9219" y2="392.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.0771" x="157.3223" y="387.856">API request + Bearer token</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg9"><line style="stroke:#181818;stroke-width:1;" x1="347.3994" x2="389.3994" y1="437.1875" y2="437.1875"/><line style="stroke:#181818;stroke-width:1;" x1="389.3994" x2="389.3994" y1="437.1875" y2="450.1875"/><line style="stroke:#181818;stroke-width:1;" x1="348.3994" x2="389.3994" y1="450.1875" y2="450.1875"/><polygon fill="#181818" points="358.3994,446.1875,348.3994,450.1875,358.3994,454.1875,354.3994,450.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.8115" x="354.3994" y="416.9888">Validate JWT signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.3369" x="377.1367" y="432.1216">(JWKS from IdP)</text></g><g class="message" data-entity-1="part3" data-entity-2="part5" id="msg10"><polygon fill="#181818" points="615.6152,475.3203,625.6152,479.3203,615.6152,483.3203,619.6152,479.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="347.3994" x2="621.6152" y1="479.3203" y2="479.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.8877" x="400.5635" y="474.2544">Forward + decoded claims</text></g><g class="message" data-entity-1="part5" data-entity-2="part6" id="msg11"><polygon fill="#181818" points="794.2188,504.4531,804.2188,508.4531,794.2188,512.4531,798.2188,508.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="627.6152" x2="800.2188" y1="508.4531" y2="508.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.6035" x="639.6152" y="503.3872">Check user permissions</text></g><g class="message" data-entity-1="part6" data-entity-2="part5" id="msg12"><polygon fill="#181818" points="638.6152,533.5859,628.6152,537.5859,638.6152,541.5859,634.6152,537.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="632.6152" x2="805.2188" y1="537.5859" y2="537.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.4443" x="684.1948" y="532.52">User roles</text></g><g class="message" data-entity-1="part5" data-entity-2="part3" id="msg13"><polygon fill="#181818" points="358.3994,562.7188,348.3994,566.7188,358.3994,570.7188,354.3994,566.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="352.3994" x2="626.6152" y1="566.7188" y2="566.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.9648" x="441.5249" y="561.6528">200 Response</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg14"><polygon fill="#181818" points="156.3223,591.8516,146.3223,595.8516,156.3223,599.8516,152.3223,595.8516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="150.3223" x2="346.3994" y1="595.8516" y2="595.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.2393" x="209.7412" y="590.7856">JSON result</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="856.0542" y1="604.8516" y2="604.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126.3872" x="15" y="615.062">[Credentials invalid]</text><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg15"><polygon fill="#181818" points="49.9551,635.7891,39.9551,639.7891,49.9551,643.7891,45.9551,639.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="43.9551" x2="508.2109" y1="639.7891" y2="639.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.3257" x="199.9202" y="634.7231">401 Invalid credentials</text></g><path d="M514,659.7891 L514,729.7891 L729,729.7891 L729,669.7891 L719,659.7891 L514,659.7891" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M719,659.7891 L719,669.7891 L729,669.7891 L719,659.7891" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50.813" x="520" y="676.856">Tokens:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.439" x="520" y="691.9888">&#8226; Access token: 15 min TTL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.7954" x="520" y="707.1216">&#8226; Refresh token: 7 day TTL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.8477" x="520" y="722.2544">&#8226; ID token: user profile claims</text><?plantuml-src RLF1RXCn4BtxAqOvjKAeQGL2sWDII5kqeP2e2VI2X1nxicl5iHVRcwMS-X5y0P_MBs7iEDkin6tZzsRcpNiJlrMcuOxlOCt5jdAsDN9gjNNGrIeWyptkyMUBHk1dz9vNED6gCY3G17IC1HKqmgGDDJqemOEo1cwrxU3vwG_C8t055p0lhwUCSH6e_rTFXTIQwAhX9i1egXLLmwHfHi0zyAOPufD52Hzvm8u_9aBL3V5Ink7X4HRExfL4brXA_gVD4jq-uxnHJFB0rzmZZA8gM98-JA1SCvQUNh-FUWeWZM8BepjRAJDYz1GH6b70FKhbK0G85YuuBMoT-esCi4Y9JGfOrkI8ZhNGa8TzwzJW9be9mc5QWsjFJka0qvS7s7Ej90F8JPEYIHvry5nOYN3cifPpufvglFabQcugFD0sb4AmMpJ-kpaJoVmVIi8hoDyUIKpgaURr0uMW4pXK4laUDmvztVykhm-Vx6LsrL4LkUxY2Vb0f0_87URfnAkw8-rRt90oXjd32ZoT60-jGz8tU_YqX8spEoZbuholeVGAkBMkuougbnWtaxG1LpkV5AX8askAhaQAhesMD-XsodioB7BaEYz7hL8YpchiYxEmg_6OLlKDbM2UVZHajfn_eTrygmD3JLTq6faoWz3wKtWpleJoW0qoHoCPCvOSSAgg0zXDkc20LKggeA_dfx-340guV0ixkgdLwYx3Wr0AU0UIFvx0nuoAR8Up6qN_t-mQIO2eu1y0?></g></svg>