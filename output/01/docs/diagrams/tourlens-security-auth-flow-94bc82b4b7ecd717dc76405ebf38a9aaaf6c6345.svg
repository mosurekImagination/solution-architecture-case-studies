<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1289px" preserveAspectRatio="none" style="width:913px;height:1289px;background:#FFFFFF;" version="1.1" viewBox="0 0 913 1289" width="913px" zoomAndPan="magnify"><title>Authentication Flow &#8212; TourLens (AWS Cognito + OAuth2)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="456.0049" x="224.6323" y="27.9951">Authentication Flow &#8212; TourLens (AWS Cognito + OAuth2)</text><rect fill="none" height="178.7344" style="stroke:#000000;stroke-width:1.5;" width="564.9639" x="10" y="327.8203"/><rect fill="none" height="251" style="stroke:#000000;stroke-width:1.5;" width="820.3843" x="75.8853" y="694.3516"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="user" id="part1-lifeline"><g><title>Tourist</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="43.2095" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="47" x2="47" y1="120.8906" y2="1194.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="app" id="part2-lifeline"><g><title>Mobile App</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="140.271" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="143.8853" x2="143.8853" y1="120.8906" y2="1194.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="alb" id="part3-lifeline"><g><title>ALB</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="411.2202" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="414.2783" x2="414.2783" y1="120.8906" y2="1194.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="cognito" id="part4-lifeline"><g><title>AWS Cognito</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="508.563" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="512.1621" x2="512.1621" y1="120.8906" y2="1194.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="api" id="part5-lifeline"><g><title>TourLens API</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="626.3828" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="629.9639" x2="629.9639" y1="120.8906" y2="1194.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="db" id="part6-lifeline"><g><title>PostgreSQL</title><rect fill="#000000" fill-opacity="0.00000" height="1073.5234" width="8" x="838.8931" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="842.5166" x2="842.5166" y1="120.8906" y2="1194.4141"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="user" id="part1-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.4189" x="20" y="117.5889">Tourist</text><ellipse cx="47.2095" cy="53.0938" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.2095,61.0938 L47.2095,88.0938 M34.2095,69.0938 L60.2095,69.0938 M47.2095,88.0938 L34.2095,103.0938 M47.2095,88.0938 L60.2095,103.0938" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="user" id="part1-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.4189" x="20" y="1206.4092">Tourist</text><ellipse cx="47.2095" cy="1218.2109" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.2095,1226.2109 L47.2095,1253.2109 M34.2095,1234.2109 L60.2095,1234.2109 M47.2095,1253.2109 L34.2095,1268.2109 M47.2095,1253.2109 L60.2095,1268.2109" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="app" id="part2-head"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.7715" x="85.8853" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="105.4087" y="93.292">Mobile App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.7715" x="92.8853" y="109.5889">(iOS / Android)</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="app" id="part2-tail"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.7715" x="85.8853" y="1193.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="105.4087" y="1213.4092">Mobile App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.7715" x="92.8853" y="1229.7061">(iOS / Android)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="alb" id="part3-head"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69.8838" x="380.2783" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.9814" x="401.7295" y="93.292">ALB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.8838" x="387.2783" y="109.5889">(HTTPS)</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="alb" id="part3-tail"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69.8838" x="380.2783" y="1193.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.9814" x="401.7295" y="1213.4092">ALB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.8838" x="387.2783" y="1229.7061">(HTTPS)</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="cognito" id="part4-head"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104.8018" x="460.1621" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8018" x="467.1621" y="93.292">AWS Cognito</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.7471" x="474.1895" y="109.5889">(User Pool)</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="cognito" id="part4-tail"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104.8018" x="460.1621" y="1193.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8018" x="467.1621" y="1213.4092">AWS Cognito</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.7471" x="474.1895" y="1229.7061">(User Pool)</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="api" id="part5-head"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.8379" x="574.9639" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9248" x="584.9204" y="93.292">TourLens API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.8379" x="581.9639" y="109.5889">(ECS Fargate)</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="api" id="part5-tail"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.8379" x="574.9639" y="1193.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9248" x="584.9204" y="1213.4092">TourLens API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.8379" x="581.9639" y="1229.7061">(ECS Fargate)</text></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="db" id="part6-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="799.5166" y="101.292">PostgreSQL</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.3184" x="819.7339" y="117.5889">(RDS)</text><path d="M824.8931,52.2969 C824.8931,42.2969 842.8931,42.2969 842.8931,42.2969 C842.8931,42.2969 860.8931,42.2969 860.8931,52.2969 L860.8931,78.2969 C860.8931,88.2969 842.8931,88.2969 842.8931,88.2969 C842.8931,88.2969 824.8931,88.2969 824.8931,78.2969 L824.8931,52.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M824.8931,52.2969 C824.8931,62.2969 842.8931,62.2969 842.8931,62.2969 C842.8931,62.2969 860.8931,62.2969 860.8931,52.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="db" id="part6-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="799.5166" y="1206.4092">PostgreSQL</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.3184" x="819.7339" y="1222.7061">(RDS)</text><path d="M824.8931,1236.0078 C824.8931,1226.0078 842.8931,1226.0078 842.8931,1226.0078 C842.8931,1226.0078 860.8931,1226.0078 860.8931,1236.0078 L860.8931,1262.0078 C860.8931,1272.0078 842.8931,1272.0078 842.8931,1272.0078 C842.8931,1272.0078 824.8931,1272.0078 824.8931,1262.0078 L824.8931,1236.0078" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M824.8931,1236.0078 C824.8931,1246.0078 842.8931,1246.0078 842.8931,1246.0078 C842.8931,1246.0078 860.8931,1246.0078 860.8931,1236.0078" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="906.2695" x="0" y="151.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="151.457" y2="151.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="154.457" y2="154.457"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="163.1382" x="371.5657" y="140.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.6123" x="377.5657" y="156.9575">Registration / Login</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="132.271,191.1563,142.271,195.1563,132.271,199.1563,136.271,195.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.2095" x2="138.271" y1="195.1563" y2="195.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.3242" x="64.0781" y="190.0903">Open app</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg2"><polygon fill="#181818" points="500.563,235.4219,510.563,239.4219,500.563,243.4219,504.563,239.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="506.563" y1="239.4219" y2="239.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.2568" x="269.2886" y="219.2231">Hosted UI redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.4399" x="234.697" y="234.356">(Authorization Code + PKCE)</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg3"><polygon fill="#181818" points="58.2095,279.6875,48.2095,283.6875,58.2095,287.6875,54.2095,283.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="52.2095" x2="511.563" y1="283.6875" y2="283.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.8999" x="243.9363" y="263.4888">Login page</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.9487" x="194.4119" y="278.6216">(email/password or social)</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg4"><polygon fill="#181818" points="500.563,308.8203,510.563,312.8203,500.563,316.8203,504.563,312.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.2095" x2="506.563" y1="312.8203" y2="312.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.0649" x="224.3538" y="307.7544">Enter credentials</text></g><path d="M10,327.8203 L74.4429,327.8203 L74.4429,334.9531 L64.4429,344.9531 L10,344.9531 L10,327.8203" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="178.7344" style="stroke:#000000;stroke-width:1.5;" width="564.9639" x="10" y="327.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="340.8872">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.7856" x="89.4429" y="340.0308">[Credentials valid]</text><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg5"><polygon fill="#181818" points="155.271,362.0859,145.271,366.0859,155.271,370.0859,151.271,366.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="149.271" x2="511.563" y1="366.0859" y2="366.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.624" x="234.605" y="361.02">Authorization code (redirect)</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg6"><polygon fill="#181818" points="500.563,406.3516,510.563,410.3516,500.563,414.3516,504.563,410.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="506.563" y1="410.3516" y2="410.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9619" x="243.936" y="390.1528">Exchange code for tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.1738" x="281.3301" y="405.2856">(code_verifier)</text></g><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg7"><polygon fill="#181818" points="155.271,435.4844,145.271,439.4844,155.271,443.4844,151.271,439.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="149.271" x2="511.563" y1="439.4844" y2="439.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.6992" x="193.5674" y="434.4185">Access token + Refresh token + ID token</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="574.9639" y1="448.4844" y2="448.4844"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125.1572" x="15" y="458.6948">[Invalid credentials]</text><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg8"><polygon fill="#181818" points="58.2095,494.5547,48.2095,498.5547,58.2095,502.5547,54.2095,498.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="52.2095" x2="511.563" y1="498.5547" y2="498.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.7578" x="232.5073" y="478.356">Error message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.4746" x="198.6489" y="493.4888">(retry or reset password)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="906.2695" x="0" y="534.1211"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="534.1211" y2="534.1211"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="537.1211" y2="537.1211"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="183.5713" x="361.3491" y="523.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165.0454" x="367.3491" y="539.6216">Authenticated API Call</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="403.2202,588.9531,413.2202,592.9531,403.2202,596.9531,407.2202,592.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="409.2202" y1="592.9531" y2="592.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.2446" x="215.1233" y="572.7544">GET /api/attractions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.9492" x="156.271" y="587.8872">Authorization: Bearer {access_token}</text></g><g class="message" data-entity-1="part3" data-entity-2="part5" id="msg10"><polygon fill="#181818" points="618.3828,618.0859,628.3828,622.0859,618.3828,626.0859,622.3828,622.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="415.2202" x2="624.3828" y1="622.0859" y2="622.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.8057" x="469.3987" y="617.02">Forward request</text></g><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg11"><line style="stroke:#181818;stroke-width:1;" x1="630.3828" x2="672.3828" y1="666.3516" y2="666.3516"/><line style="stroke:#181818;stroke-width:1;" x1="672.3828" x2="672.3828" y1="666.3516" y2="679.3516"/><line style="stroke:#181818;stroke-width:1;" x1="631.3828" x2="672.3828" y1="679.3516" y2="679.3516"/><polygon fill="#181818" points="641.3828,675.3516,631.3828,679.3516,641.3828,683.3516,637.3828,679.3516" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.8115" x="637.3828" y="646.1528">Validate JWT signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.6997" x="642.4387" y="661.2856">(Cognito public keys)</text></g><path d="M75.8853,694.3516 L140.3281,694.3516 L140.3281,701.4844 L130.3281,711.4844 L75.8853,711.4844 L75.8853,694.3516" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="251" style="stroke:#000000;stroke-width:1.5;" width="820.3843" x="75.8853" y="694.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="90.8853" y="707.4185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170.2476" x="155.3281" y="706.562">[Token valid &amp; not expired]</text><g class="message" data-entity-1="part5" data-entity-2="part6" id="msg12"><polygon fill="#181818" points="830.8931,728.6172,840.8931,732.6172,830.8931,736.6172,834.8931,732.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="630.3828" x2="836.8931" y1="732.6172" y2="732.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.9341" x="679.6709" y="727.5513">Query attractions</text></g><g class="message" data-entity-1="part6" data-entity-2="part5" id="msg13"><polygon fill="#181818" points="641.3828,757.75,631.3828,761.75,641.3828,765.75,637.3828,761.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="635.3828" x2="841.8931" y1="761.75" y2="761.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.5249" x="712.8755" y="756.6841">Results</text></g><g class="message" data-entity-1="part5" data-entity-2="part3" id="msg14"><polygon fill="#181818" points="426.2202,786.8828,416.2202,790.8828,426.2202,794.8828,422.2202,790.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="420.2202" x2="629.3828" y1="790.8828" y2="790.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.9028" x="473.3501" y="785.8169">200 OK + JSON</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg15"><polygon fill="#181818" points="155.271,816.0156,145.271,820.0156,155.271,824.0156,151.271,820.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="149.271" x2="414.2202" y1="820.0156" y2="820.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.0195" x="248.2358" y="814.9497">Response</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="75.8853" x2="896.2695" y1="829.0156" y2="829.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="98.5112" x="80.8853" y="839.2261">[Token expired]</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg16"><polygon fill="#181818" points="500.563,875.0859,510.563,879.0859,500.563,883.0859,504.563,879.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="506.563" y1="879.0859" y2="879.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.9111" x="282.9614" y="858.8872">Refresh token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.0669" x="237.8835" y="874.02">(grant_type=refresh_token)</text></g><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg17"><polygon fill="#181818" points="155.271,904.2188,145.271,908.2188,155.271,912.2188,151.271,908.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="149.271" x2="511.563" y1="908.2188" y2="908.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.2412" x="269.7964" y="903.1528">New access token</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg18"><polygon fill="#181818" points="403.2202,933.3516,413.2202,937.3516,403.2202,941.3516,407.2202,937.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="409.2202" y1="937.3516" y2="937.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8296" x="210.3308" y="932.2856">Retry with new token</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="906.2695" x="0" y="972.918"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="972.918" y2="972.918"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="906.2695" y1="975.918" y2="975.918"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="213.9194" x="346.175" y="962.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.3936" x="352.175" y="978.4185">Photo Upload (Authorized)</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg19"><polygon fill="#181818" points="132.271,1012.6172,142.271,1016.6172,132.271,1020.6172,136.271,1016.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.2095" x2="138.271" y1="1016.6172" y2="1016.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.0615" x="59.2095" y="1011.5513">Take photo</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg20"><polygon fill="#181818" points="403.2202,1056.8828,413.2202,1060.8828,403.2202,1064.8828,407.2202,1060.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="144.271" x2="409.2202" y1="1060.8828" y2="1060.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.2554" x="224.1179" y="1040.6841">POST /api/photos</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.9492" x="156.271" y="1055.8169">Authorization: Bearer {access_token}</text></g><g class="message" data-entity-1="part3" data-entity-2="part5" id="msg21"><polygon fill="#181818" points="618.3828,1086.0156,628.3828,1090.0156,618.3828,1094.0156,622.3828,1090.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="415.2202" x2="624.3828" y1="1090.0156" y2="1090.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.9712" x="496.3159" y="1084.9497">Forward</text></g><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg22"><line style="stroke:#181818;stroke-width:1;" x1="630.3828" x2="672.3828" y1="1119.1484" y2="1119.1484"/><line style="stroke:#181818;stroke-width:1;" x1="672.3828" x2="672.3828" y1="1119.1484" y2="1132.1484"/><line style="stroke:#181818;stroke-width:1;" x1="631.3828" x2="672.3828" y1="1132.1484" y2="1132.1484"/><polygon fill="#181818" points="641.3828,1128.1484,631.3828,1132.1484,641.3828,1136.1484,637.3828,1132.1484" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5103" x="637.3828" y="1114.0825">Validate JWT + extract user_id</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg23"><polygon fill="#181818" points="155.271,1172.4141,145.271,1176.4141,155.271,1180.4141,151.271,1176.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="149.271" x2="629.3828" y1="1176.4141" y2="1176.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.7305" x="342.4617" y="1156.2153">202 Accepted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.7031" x="318.9753" y="1171.3481">(recognition queued)</text></g><?plantuml-src fLFDJXin4BxlKumuLAnG5PHZf5GA8PH08249vL8fykuE6ol6TcqlWLQL-X1zmZv9n_PcawNjgGUai9wPxs_6RhZKpB0do5Y-AOsgP35KGXdOhhd3n3Rl5hzKA7EyGMjPYGF1ImavIeScIHnt0c5GkJLzu3bpN4cu46eBltxyXAMgp0IbXUF1mmA6gfJSAJY1gM_efad2SaU8HxwEMtS4p49bQIuXqpIkcNHmTACoxa6q_YoF-NG17HZ8mYXUfA63QTrk64pEgF9okPmjwWgHlQdOqw7AUuA4cL8YLkVneTtHI1dCnjGo6YxWWfcIEToHu4d17CkOHJYQAUjAWukx2TNEpsiQHPOa_JxCiIIn9dhLWOagkOH-F_7AuVq7hwS7KuqoAAC__x4crODB6eq5t8_1OC4DveuWl9_AyAznvb0LI2xFheUZDAaR_GmFqAlnD4L9ZVZ4kEXePkrMcG8e3AjopaJQi6c0Hpvno0dLHys4fVY4W-7-0pmpmOi4u00pY6dJopszuntxbEhVQXozv6icIuobZyJAgGsPJuJzbzKp6lx8qQI7M0rOdjEcnWvoOOwF1ksw-Nzy7dycA2YfiGoSMxBQCwDf8sE8nLCy0Q9Xq9bNRnVDHWSx0zC4PH52FZW9IekM1ePC21zpBPPsiWSVHqleqEfqcAE5oBqz9B9bLm_Ea1bo_XiBmbQ1_NVoFel-yXvSABDb59_nfseTGV3cxPFNHoJWwc49bcwNkSfu2Rjpr5KcU0uRVBLfZ7GPh8h6l0Ef7E2Bfh2A45KONH3vkmh9WmFcz5naTH24F4TR2MTtJJlDtTDJc5vJ4bUBwQr_5Da-FEhHD0bZEf788NXxJrhPagJIqAsktAl6lebFqQs_xiajRe4TxCf-Vg0v3mblkLk3fCfwP-fqPsj5e-wrKAo0vlgmIF-uuoNR86XVtWf-DbtKoOUt_mZzts6Va7CXcx33ArwNxfXrJxlXLZGjQDZew92_KDgYYiJy1W00?></g></svg>