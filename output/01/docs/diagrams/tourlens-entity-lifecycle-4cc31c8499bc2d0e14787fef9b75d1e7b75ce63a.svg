<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="1597px" preserveAspectRatio="none" style="width:543px;height:1597px;background:#FFFFFF;" version="1.1" viewBox="0 0 543 1597" width="543px" zoomAndPan="magnify"><title>PhotoRecognition State Machine</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="258.2754" x="135.7277" y="22.9951">PhotoRecognition State Machine</text></g><ellipse cx="194.87" cy="53.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="86.5547" x="151.6" y="140.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="151.6" x2="238.1547" y1="166.5938" y2="166.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.5547" x="161.6" y="158.292">Uploaded</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74.8789" x="157.43" y="267.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="157.43" x2="232.3089" y1="293.5938" y2="293.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.8789" x="167.43" y="285.292">Queued</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="95.3115" x="147.22" y="394.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="147.22" x2="242.5315" y1="420.5938" y2="420.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.3115" x="157.22" y="412.292">Processing</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="101.1016" x="126.32" y="1029.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="126.32" x2="227.4216" y1="1055.5938" y2="1055.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1016" x="136.32" y="1047.292">Recognized</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="126.5313" x="131.61" y="521.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="131.61" x2="258.1413" y1="547.5938" y2="547.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.5313" x="141.61" y="539.292">LowConfidence</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="61.9111" x="336.92" y="775.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="336.92" x2="398.8311" y1="801.5938" y2="801.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.9111" x="346.92" y="793.292">Failed</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="152.9932" x="118.38" y="648.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="118.38" x2="271.3732" y1="674.5938" y2="674.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.9932" x="128.38" y="666.292">FallbackProcessing</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="90.417" x="131.66" y="1189.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="131.66" x2="222.077" y1="1215.5938" y2="1215.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.417" x="141.66" y="1207.292">Described</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="125.7451" x="7" y="1331.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="132.7451" y1="1357.5938" y2="1357.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.7451" x="17" y="1349.292">OffersAttached</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="96.3574" x="172.69" y="1458.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="172.69" x2="269.0474" y1="1484.5938" y2="1484.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.3574" x="182.69" y="1476.292">Completed</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="121.4521" x="326.15" y="902.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="326.15" x2="447.6021" y1="928.5938" y2="928.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.4521" x="336.15" y="920.292">ManualReview</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="90.3828" x="351.68" y="1109.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="351.68" x2="442.0628" y1="1135.5938" y2="1135.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.3828" x="361.68" y="1127.292">Discarded</text></g><ellipse cx="308.87" cy="1580.2969" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="308.87" cy="1580.2969" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><!--link *start* to Uploaded--><g class="link" data-entity-1="ent0002" data-entity-2="ent0003" data-link-type="dependency" data-source-line="4" id="lnk4"><path d="M194.87,63.6769 C194.87,80.4069 194.87,109.8869 194.87,133.9269" fill="none" id="*start*-to-Uploaded" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="194.87,139.9269,198.87,130.9269,194.87,134.9269,190.87,130.9269,194.87,139.9269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.7539" x="195.87" y="106.3638">User takes photo</text></g><!--link Uploaded to Queued--><g class="link" data-entity-1="ent0003" data-entity-2="ent0005" data-link-type="dependency" data-source-line="6" id="lnk6"><path d="M194.87,190.6969 C194.87,212.7169 194.87,238.9569 194.87,260.9569" fill="none" id="Uploaded-to-Queued" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="194.87,266.9569,198.87,257.9569,194.87,261.9569,190.87,257.9569,194.87,266.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.8325" x="195.87" y="233.3638">SQS enqueue</text></g><!--link Queued to Processing--><g class="link" data-entity-1="ent0005" data-entity-2="ent0007" data-link-type="dependency" data-source-line="8" id="lnk8"><path d="M194.87,317.6969 C194.87,339.7169 194.87,365.9569 194.87,387.9569" fill="none" id="Queued-to-Processing" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="194.87,393.9569,198.87,384.9569,194.87,388.9569,190.87,384.9569,194.87,393.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.4111" x="195.87" y="360.3638">Lambda picks up</text></g><!--link Processing to Recognized--><g class="link" data-entity-1="ent0007" data-entity-2="ent0009" data-link-type="dependency" data-source-line="10" id="lnk10"><path d="M147.07,433.0869 C96.78,449.7769 24.87,484.3069 24.87,545.2969 C24.87,545.2969 24.87,545.2969 24.87,928.2969 C24.87,981.7669 76.1676,1014.2076 120.3276,1033.1876" fill="none" id="Processing-to-Recognized" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="125.84,1035.5569,119.1509,1028.3281,121.2463,1033.5825,115.9919,1035.678,125.84,1035.5569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8545" x="25.87" y="741.3638">AI confidence &#8805; 0.7</text></g><!--link Processing to LowConfidence--><g class="link" data-entity-1="ent0007" data-entity-2="ent0011" data-link-type="dependency" data-source-line="11" id="lnk12"><path d="M194.87,444.6969 C194.87,466.7169 194.87,492.9569 194.87,514.9569" fill="none" id="Processing-to-LowConfidence" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="194.87,520.9569,198.87,511.9569,194.87,515.9569,190.87,511.9569,194.87,520.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8545" x="195.87" y="487.3638">AI confidence &lt; 0.7</text></g><!--link Processing to Failed--><g class="link" data-entity-1="ent0007" data-entity-2="ent0013" data-link-type="dependency" data-source-line="12" id="lnk14"><path d="M242.7,426.4869 C273.13,433.0669 310.67,446.5769 331.87,474.2969 C401.87,565.8369 384.5609,710.6532 373.9509,769.1432" fill="none" id="Processing-to-Failed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="372.88,775.0469,378.4221,766.9053,373.7724,770.1272,370.5506,765.4774,372.88,775.0469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.8608" x="381.87" y="614.3638">All providers exhausted</text></g><!--link LowConfidence to FallbackProcessing--><g class="link" data-entity-1="ent0011" data-entity-2="ent0015" data-link-type="dependency" data-source-line="14" id="lnk16"><path d="M194.87,571.6969 C194.87,593.7169 194.87,619.9569 194.87,641.9569" fill="none" id="LowConfidence-to-FallbackProcessing" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="194.87,647.9569,198.87,638.9569,194.87,642.9569,190.87,638.9569,194.87,647.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.7217" x="195.87" y="614.3638">Try next provider</text></g><!--link FallbackProcessing to Recognized--><g class="link" data-entity-1="ent0015" data-entity-2="ent0009" data-link-type="dependency" data-source-line="15" id="lnk17"><path d="M193.72,698.5769 C190.47,767.0369 181.5447,955.0136 178.3047,1023.2236" fill="none" id="FallbackProcessing-to-Recognized" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="178.02,1029.2169,182.4425,1020.4168,178.2572,1024.2225,174.4515,1020.0372,178.02,1029.2169" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.689" x="187.87" y="868.3638">Fallback confidence &#8805; 0.7</text></g><!--link FallbackProcessing to Failed--><g class="link" data-entity-1="ent0015" data-entity-2="ent0013" data-link-type="dependency" data-source-line="16" id="lnk18"><path d="M202.52,698.4669 C208.41,713.6669 217.94,732.7269 231.87,745.2969 C261.67,772.1869 300.6466,785.095 330.5966,792.075" fill="none" id="FallbackProcessing-to-Failed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="336.44,793.4369,328.5828,787.4985,331.5705,792.302,326.767,795.2897,336.44,793.4369" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.4497" x="232.87" y="741.3638">No providers left</text></g><!--link Recognized to Described--><g class="link" data-entity-1="ent0009" data-entity-2="ent0019" data-link-type="dependency" data-source-line="18" id="lnk20"><path d="M176.87,1079.6369 C176.87,1109.3269 176.87,1153.2269 176.87,1182.9269" fill="none" id="Recognized-to-Described" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="176.87,1188.9269,180.87,1179.9269,176.87,1183.9269,172.87,1179.9269,176.87,1188.9269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.3169" x="179.2252" y="1131.3638">Description generated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.0273" x="177.87" y="1146.4966">(text + optional audio)</text></g><!--link Described to OffersAttached--><g class="link" data-entity-1="ent0019" data-entity-2="ent0021" data-link-type="dependency" data-source-line="19" id="lnk22"><path d="M131.29,1222.3869 C103.53,1229.3169 70.18,1242.8769 52.87,1269.2969 C40.86,1287.6269 45.2567,1307.0849 53.5767,1325.3849" fill="none" id="Described-to-OffersAttached" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="56.06,1330.8469,55.9764,1320.9984,53.9906,1326.2952,48.6938,1324.3094,56.06,1330.8469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.7085" x="53.87" y="1282.3638">Nearby partner offers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.9038" x="76.7723" y="1297.4966">found &amp; linked</text></g><!--link Described to Completed--><g class="link" data-entity-1="ent0019" data-entity-2="ent0023" data-link-type="dependency" data-source-line="20" id="lnk24"><path d="M188.46,1239.5369 C192.37,1248.6769 196.37,1259.2769 198.87,1269.2969 C215.59,1336.1969 219.4859,1411.9886 220.4459,1451.9586" fill="none" id="Described-to-Completed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="220.59,1457.9569,224.3727,1448.8634,220.4699,1452.9583,216.3751,1449.0555,220.59,1457.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8433" x="217.87" y="1360.8638">No offers available</text></g><!--link OffersAttached to Completed--><g class="link" data-entity-1="ent0021" data-entity-2="ent0023" data-link-type="dependency" data-source-line="22" id="lnk25"><path d="M67.84,1381.7669 C67.9,1396.7169 70.46,1415.3769 80.87,1428.2969 C103.18,1455.9869 135.6318,1468.2462 166.5518,1474.8362" fill="none" id="OffersAttached-to-Completed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="172.42,1476.0869,164.4515,1470.2987,167.5298,1475.0446,162.7839,1478.123,172.42,1476.0869" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.1885" x="81.87" y="1424.3638">Delivered to user</text></g><!--link Failed to ManualReview--><g class="link" data-entity-1="ent0013" data-entity-2="ent0026" data-link-type="dependency" data-source-line="24" id="lnk27"><path d="M371.58,825.6969 C374.93,847.7169 378.9294,874.0248 382.2694,896.0248" fill="none" id="Failed-to-ManualReview" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="383.17,901.9569,385.7738,892.4584,382.4195,897.0135,377.8644,893.6592,383.17,901.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.2275" x="378.87" y="868.3638">Flagged for review</text></g><!--link ManualReview to Recognized--><g class="link" data-entity-1="ent0026" data-entity-2="ent0009" data-link-type="dependency" data-source-line="25" id="lnk28"><path d="M326,940.8169 C295.73,949.1069 259.75,962.2469 231.87,982.2969 C214.78,994.5869 203.646,1008.5979 193.896,1023.8879" fill="none" id="ManualReview-to-Recognized" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="190.67,1028.9469,198.8816,1023.5091,193.3583,1024.7311,192.1363,1019.2078,190.67,1028.9469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.0405" x="232.87" y="995.3638">Manually matched</text></g><!--link ManualReview to Discarded--><g class="link" data-entity-1="ent0026" data-entity-2="ent0029" data-link-type="dependency" data-source-line="26" id="lnk30"><path d="M388.06,952.6169 C389.98,992.0769 393.4667,1063.584 395.3967,1103.014" fill="none" id="ManualReview-to-Discarded" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="395.69,1109.0069,399.2452,1099.8221,395.4456,1104.0129,391.2548,1100.2132,395.69,1109.0069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.5811" x="390.87" y="995.3638">Unrecognizable photo</text></g><!--link Completed to *end*--><g class="link" data-entity-1="ent0023" data-entity-2="ent0031" data-link-type="dependency" data-source-line="28" id="lnk32"><path d="M243.53,1508.7569 C262.89,1529.6569 285.4227,1553.9851 297.8627,1567.4151" fill="none" id="Completed-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="301.94,1571.8169,298.7586,1562.496,298.5423,1568.1487,292.8895,1567.9324,301.94,1571.8169" style="stroke:#181818;stroke-width:1;"/></g><!--link Discarded to *end*--><g class="link" data-entity-1="ent0029" data-entity-2="ent0031" data-link-type="dependency" data-source-line="29" id="lnk33"><path d="M396.87,1159.5569 C396.87,1189.0469 396.87,1240.3169 396.87,1284.2969 C396.87,1284.2969 396.87,1284.2969 396.87,1484.2969 C396.87,1529.9369 346.8826,1560.1961 323.9726,1571.9061" fill="none" id="Discarded-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="318.63,1574.6369,328.4643,1574.1025,323.0821,1572.3613,324.8234,1566.979,318.63,1574.6369" style="stroke:#181818;stroke-width:1;"/></g><?plantuml-src TPDBRjmm38RtF0LNHHz8q5s1eYWGpA10WAHDCisgoOAMQOzWZUXAz4ocD-X1Uh6Uf9BjUKztjlZzv4-AYetrBGLQO46cgODqlfo8au2hkLK6jUeOx-QYyi16Qc_LYiUPaZBUafbRpm0_tZxZnSLdV6oTKCabViJ7o06L6exOPZN0DfZ9-uwxdflTpv3zp_mBC9vcu2w8uHYjhnDqGukY96ojQI9sBS1UDCEZjLzzngjhDE8hMx8tZ7z__y7tbn-E5JUockoWOz6dSv8lPDrGm3biWomJ72Boovowg5m272OTDCxbmHvqypsiqVEBRfF06UoahGrphhd_wBUElygUOSUL0kpbpkYKemcswEdXk-qlkcRF8Trr-UHVQ_Ry3gMFa4FgIYjlO2VDYRvLLIfofPfsOwZD58erfYNJb0gbZp_vAcyQla9dVPDcTvXa8elMiMwy3ngaPUg72fSMvQZAiMRApYuvf6yLxD8c0eopoEGj-OxS0oyjh_9W7TLr2bLfwKD_20V4oKqCKRV61MakVufFRJGKneVWmoZErZUFOUSsy-dzm4updlm3?></g></svg>