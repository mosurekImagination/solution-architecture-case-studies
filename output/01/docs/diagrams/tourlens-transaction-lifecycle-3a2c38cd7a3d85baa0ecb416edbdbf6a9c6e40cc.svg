<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="708px" preserveAspectRatio="none" style="width:607px;height:708px;background:#FFFFFF;" version="1.1" viewBox="0 0 607 708" width="607px" zoomAndPan="magnify"><title>Transaction State Machine</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="211.0869" x="191.1399" y="22.9951">Transaction State Machine</text></g><ellipse cx="45.92" cy="53.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="77.8389" x="7" y="140.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="84.8389" y1="166.5938" y2="166.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.8389" x="17" y="158.292">Initiated</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="138.3848" x="158.73" y="267.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="158.73" x2="297.1148" y1="293.5938" y2="293.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.3848" x="168.73" y="285.292">PaymentPending</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="96.3574" x="214.74" y="409.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="214.74" x2="311.0974" y1="435.5938" y2="435.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.3574" x="224.74" y="427.292">Completed</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="61.9111" x="35.96" y="409.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="35.96" x2="97.8711" y1="435.5938" y2="435.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.9111" x="45.96" y="427.292">Failed</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="73.1631" x="407.34" y="489.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="407.34" x2="480.5031" y1="515.5938" y2="515.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.1631" x="417.34" y="507.292">Expired</text></g><g><rect fill="#F1F1F1" height="50" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.6426" x="200.6" y="569.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="200.6" x2="333.2426" y1="595.5938" y2="595.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112.6426" x="210.6" y="587.292">LoyaltyAwarded</text></g><ellipse cx="266.92" cy="691.2969" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="266.92" cy="691.2969" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><!--link *start* to Initiated--><g class="link" data-entity-1="ent0002" data-entity-2="ent0003" data-link-type="dependency" data-source-line="4" id="lnk4"><path d="M45.92,63.6769 C45.92,80.4069 45.92,109.8869 45.92,133.9269" fill="none" id="*start*-to-Initiated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="45.92,139.9269,49.92,130.9269,45.92,134.9269,41.92,130.9269,45.92,139.9269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.7437" x="46.92" y="106.3638">User selects offer</text></g><!--link Initiated to PaymentPending--><g class="link" data-entity-1="ent0003" data-entity-2="ent0005" data-link-type="dependency" data-source-line="6" id="lnk6"><path d="M81.44,190.6969 C113.51,212.7169 155.4933,241.5613 187.5433,263.5613" fill="none" id="Initiated-to-PaymentPending" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="192.49,266.9569,187.3336,258.5657,188.3677,264.1272,182.8062,265.1613,192.49,266.9569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.9746" x="148.92" y="233.3638">Stripe checkout created</text></g><!--link PaymentPending to Completed--><g class="link" data-entity-1="ent0005" data-entity-2="ent0007" data-link-type="dependency" data-source-line="8" id="lnk8"><path d="M234.02,317.6869 C240.44,343.3769 249.0464,377.7756 255.4364,403.3656" fill="none" id="PaymentPending-to-Completed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="256.89,409.1869,258.5904,399.4859,255.6787,404.3358,250.8288,401.4241,256.89,409.1869" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.625" x="285.4224" y="360.3638">Stripe webhook:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.6299" x="249.92" y="375.4966">payment_intent.succeeded</text></g><!--link PaymentPending to Failed--><g class="link" data-entity-1="ent0005" data-entity-2="ent0009" data-link-type="dependency" data-source-line="9" id="lnk10"><path d="M158.5,307.1469 C134.17,315.1769 108.55,327.7369 90.92,347.2969 C75.66,364.2169 70.6525,384.1014 68.6125,403.0414" fill="none" id="PaymentPending-to-Failed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="67.97,409.0069,72.9108,400.487,68.5054,404.0356,64.9568,399.6303,67.97,409.0069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.625" x="110.5282" y="360.3638">Stripe webhook:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.8413" x="91.92" y="375.4966">payment_intent.failed</text></g><!--link PaymentPending to Expired--><g class="link" data-entity-1="ent0005" data-entity-2="ent0011" data-link-type="dependency" data-source-line="10" id="lnk12"><path d="M297.54,302.5669 C350.62,311.1869 417.47,325.9369 434.92,347.2969 C467.87,387.6469 460.1836,447.7716 451.9836,483.1816" fill="none" id="PaymentPending-to-Expired" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="450.63,489.0269,456.5573,481.1613,451.758,484.1558,448.7635,479.3565,450.63,489.0269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.4468" x="452.92" y="367.8638">No response in 30 min</text></g><!--link Completed to LoyaltyAwarded--><g class="link" data-entity-1="ent0007" data-entity-2="ent0013" data-link-type="dependency" data-source-line="12" id="lnk14"><path d="M263.54,459.6369 C264.29,489.3269 265.3985,533.2288 266.1485,562.9288" fill="none" id="Completed-to-LoyaltyAwarded" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="266.3,568.9269,270.0715,559.8288,266.1738,563.9285,262.0741,560.0307,266.3,568.9269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.3477" x="266.92" y="518.8638">Points credited</text></g><!--link LoyaltyAwarded to *end*--><g class="link" data-entity-1="ent0013" data-entity-2="ent0015" data-link-type="dependency" data-source-line="13" id="lnk16"><path d="M266.92,619.7569 C266.92,639.3369 266.92,659.7869 266.92,674.0969" fill="none" id="LoyaltyAwarded-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="266.92,680.0969,270.92,671.0969,266.92,675.0969,262.92,671.0969,266.92,680.0969" style="stroke:#181818;stroke-width:1;"/></g><!--link Failed to Initiated--><g class="link" data-entity-1="ent0009" data-entity-2="ent0003" data-link-type="dependency" data-source-line="15" id="lnk17"><path d="M65.01,408.9969 C61.01,358.1669 52.2807,247.1484 48.2907,196.4484" fill="none" id="Failed-to-Initiated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="47.82,190.4669,44.5384,199.753,48.2123,195.4515,52.5138,199.1253,47.82,190.4669" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75.9307" x="58.92" y="296.8638">User retries</text></g><!--link Failed to *end*--><g class="link" data-entity-1="ent0009" data-entity-2="ent0015" data-link-type="dependency" data-source-line="16" id="lnk18"><path d="M61.76,459.5969 C55.14,497.7369 48.37,572.1769 83.92,619.2969 C127.23,676.6969 217.4725,687.32 249.9725,689.42" fill="none" id="Failed-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="255.96,689.8069,247.2367,685.2349,250.9704,689.4845,246.7208,693.2182,255.96,689.8069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.4048" x="84.92" y="598.8638">User abandons</text></g><!--link Expired to *end*--><g class="link" data-entity-1="ent0011" data-entity-2="ent0015" data-link-type="dependency" data-source-line="18" id="lnk19"><path d="M423.77,539.7069 C405.52,561.3569 377.49,593.4569 350.92,619.2969 C324.64,644.8569 295.2669,668.3343 279.8569,680.3143" fill="none" id="Expired-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="275.12,683.9969,284.6805,681.631,279.0675,680.9281,279.7704,675.315,275.12,683.9969" style="stroke:#181818;stroke-width:1;"/></g><?plantuml-src ZP51ImD138Nl-HKv2nN1Mm-250L1fL0zgKWwatR3xYRBJ4hjltTcNQcK7ZpD8TzxUI-JMz614lMufj1ka-qqBgopXFj6dC75EyQNH9efk9ZYoiaPdoWqeWpmTl61izaDFgYub4d4ERvcJfYvu-0PRRFX172SLtf9XvxLbwnHT5iaAqyoC8Q6Gsixnv2umW0dP1Klh1yw_barwVQyRipQ-NifC_AVebwUoxmBWJaMfpD6zoJTlrms8tZEukvha3HwF1icpeDfPXJ5woliHG6EOIl-Q0Vg_72xfnH7rTBAYbphHgbzJu2gAHS6cAAUlNJY4f_pNwR-oZIbDMaigG1-iqx0Dm00?></g></svg>