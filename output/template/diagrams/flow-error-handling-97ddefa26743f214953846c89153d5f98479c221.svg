<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="709px" preserveAspectRatio="none" style="width:711px;height:709px;background:#FFFFFF;" version="1.1" viewBox="0 0 711 709" width="711px" zoomAndPan="magnify"><title>[Scenario] &#8212; Error Handling</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="220.6641" x="246.4468" y="27.9951">[Scenario] &#8212; Error Handling</text><rect fill="none" height="294.1328" style="stroke:#000000;stroke-width:1.5;" width="694.5576" x="10" y="252.125"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="34.9551" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="38" x2="38" y1="118.5938" y2="628.6563"/></g><g><title>Mobile App</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="166.4209" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="169.5586" x2="169.5586" y1="118.5938" y2="628.6563"/></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="306.6465" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="310.4248" x2="310.4248" y1="118.5938" y2="628.6563"/></g><g><title>Auth Service</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="452.5342" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="456.0322" x2="456.0322" y1="118.5938" y2="628.6563"/></g><g><title>Service A</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="553.9204" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="557.0361" x2="557.0361" y1="118.5938" y2="628.6563"/></g><g><title>PostgreSQL</title><rect fill="#000000" fill-opacity="0.00000" height="510.0625" width="8" x="647.1812" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="650.8047" x2="650.8047" y1="118.5938" y2="628.6563"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="20" y="115.292">User</text><ellipse cx="38.9551" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.9551,58.7969 L38.9551,85.7969 M25.9551,66.7969 L51.9551,66.7969 M38.9551,85.7969 L25.9551,100.7969 M38.9551,85.7969 L51.9551,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="20" y="640.6514">User</text><ellipse cx="38.9551" cy="652.4531" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.9551,660.4531 L38.9551,687.4531 M25.9551,668.4531 L51.9551,668.4531 M38.9551,687.4531 L25.9551,702.4531 M38.9551,687.4531 L51.9551,702.4531" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="app"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91.7246" x="124.5586" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="131.5586" y="107.292">Mobile App</text></g><g class="participant participant-tail" data-participant="app"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91.7246" x="124.5586" y="627.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="131.5586" y="647.6514">Mobile App</text></g><g class="participant participant-head" data-participant="gw"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="259.4248" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="266.4248" y="107.292">API Gateway</text></g><g class="participant participant-tail" data-participant="gw"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="259.4248" y="627.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="266.4248" y="647.6514">API Gateway</text></g><g class="participant participant-head" data-participant="auth"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.0039" x="405.0322" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.0039" x="412.0322" y="107.292">Auth Service</text></g><g class="participant participant-tail" data-participant="auth"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.0039" x="405.0322" y="627.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.0039" x="412.0322" y="647.6514">Auth Service</text></g><g class="participant participant-head" data-participant="svc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79.7686" x="518.0361" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.7686" x="525.0361" y="107.292">Service A</text></g><g class="participant participant-tail" data-participant="svc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79.7686" x="518.0361" y="627.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.7686" x="525.0361" y="647.6514">Service A</text></g><g class="participant participant-head" data-participant="db"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="607.8047" y="115.292">PostgreSQL</text><path d="M633.1812,66.2969 C633.1812,56.2969 651.1812,56.2969 651.1812,56.2969 C651.1812,56.2969 669.1812,56.2969 669.1812,66.2969 L669.1812,92.2969 C669.1812,102.2969 651.1812,102.2969 651.1812,102.2969 C651.1812,102.2969 633.1812,102.2969 633.1812,92.2969 L633.1812,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M633.1812,66.2969 C633.1812,76.2969 651.1812,76.2969 651.1812,76.2969 C651.1812,76.2969 669.1812,76.2969 669.1812,66.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="db"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="607.8047" y="640.6514">PostgreSQL</text><path d="M633.1812,653.9531 C633.1812,643.9531 651.1812,643.9531 651.1812,643.9531 C651.1812,643.9531 669.1812,643.9531 669.1812,653.9531 L669.1812,679.9531 C669.1812,689.9531 651.1812,689.9531 651.1812,689.9531 C651.1812,689.9531 633.1812,689.9531 633.1812,679.9531 L633.1812,653.9531" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M633.1812,653.9531 C633.1812,663.9531 651.1812,663.9531 651.1812,663.9531 C651.1812,663.9531 669.1812,663.9531 669.1812,653.9531" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="message" data-participant-1="User" data-participant-2="app"><polygon fill="#181818" points="158.4209,145.7266,168.4209,149.7266,158.4209,153.7266,162.4209,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="38.9551" x2="164.4209" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.3765" x="56.4998" y="144.6606">Initiates action</text></g><g class="message" data-participant-1="app" data-participant-2="gw"><polygon fill="#181818" points="298.6465,174.8594,308.6465,178.8594,298.6465,182.8594,302.6465,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="170.4209" x2="304.6465" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.0024" x="187.0325" y="173.7935">POST /api/action</text></g><g class="message" data-participant-1="gw" data-participant-2="auth"><polygon fill="#181818" points="444.5342,203.9922,454.5342,207.9922,444.5342,211.9922,448.5342,207.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="310.6465" x2="450.5342" y1="207.9922" y2="207.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3452" x="336.4177" y="202.9263">Validate token</text></g><g class="message" data-participant-1="auth" data-participant-2="gw"><polygon fill="#181818" points="321.6465,233.125,311.6465,237.125,321.6465,241.125,317.6465,237.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="315.6465" x2="455.5342" y1="237.125" y2="237.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8877" x="322.6465" y="232.0591">401 Token expired</text></g><path d="M10,252.125 L74.4429,252.125 L74.4429,259.2578 L64.4429,269.2578 L10,269.2578 L10,252.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="294.1328" style="stroke:#000000;stroke-width:1.5;" width="694.5576" x="10" y="252.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="265.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156.4009" x="89.4429" y="264.3354">[Token refresh available]</text><g class="message" data-participant-1="gw" data-participant-2="auth"><polygon fill="#181818" points="444.5342,286.3906,454.5342,290.3906,444.5342,294.3906,448.5342,290.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="310.6465" x2="450.5342" y1="290.3906" y2="290.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.9111" x="338.1348" y="285.3247">Refresh token</text></g><g class="message" data-participant-1="auth" data-participant-2="gw"><polygon fill="#181818" points="321.6465,315.5234,311.6465,319.5234,321.6465,323.5234,317.6465,319.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="315.6465" x2="455.5342" y1="319.5234" y2="319.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.249" x="334.4658" y="314.4575">200 New token</text></g><g class="message" data-participant-1="gw" data-participant-2="svc"><polygon fill="#181818" points="545.9204,344.6563,555.9204,348.6563,545.9204,352.6563,549.9204,348.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="310.6465" x2="551.9204" y1="348.6563" y2="348.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8296" x="364.8687" y="343.5903">Retry with new token</text></g><g class="message" data-participant-1="svc" data-participant-2="db"><polygon fill="#181818" points="639.1812,373.7891,649.1812,377.7891,639.1812,381.7891,643.1812,377.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="557.9204" x2="645.1812" y1="377.7891" y2="377.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39.5078" x="584.7969" y="372.7231">Query</text></g><g class="message" data-participant-1="db" data-participant-2="svc"><polygon fill="#181818" points="568.9204,402.9219,558.9204,406.9219,568.9204,410.9219,564.9204,406.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="562.9204" x2="650.1812" y1="406.9219" y2="406.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40.752" x="584.1748" y="401.856">Result</text></g><g class="message" data-participant-1="svc" data-participant-2="gw"><polygon fill="#181818" points="321.6465,432.0547,311.6465,436.0547,321.6465,440.0547,317.6465,436.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="315.6465" x2="556.9204" y1="436.0547" y2="436.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="410.4321" y="430.9888">200 OK</text></g><g class="message" data-participant-1="gw" data-participant-2="app"><polygon fill="#181818" points="181.4209,461.1875,171.4209,465.1875,181.4209,469.1875,177.4209,465.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="175.4209" x2="309.6465" y1="465.1875" y2="465.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.2393" x="203.9141" y="460.1216">JSON result</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="704.5576" y1="474.1875" y2="474.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.834" x="15" y="484.3979">[No refresh token]</text><g class="message" data-participant-1="gw" data-participant-2="app"><polygon fill="#181818" points="181.4209,505.125,171.4209,509.125,181.4209,513.125,177.4209,509.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="175.4209" x2="309.6465" y1="509.125" y2="509.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.2256" x="182.4209" y="504.0591">401 Unauthorized</text></g><g class="message" data-participant-1="app" data-participant-2="User"><polygon fill="#181818" points="49.9551,534.2578,39.9551,538.2578,49.9551,542.2578,45.9551,538.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="43.9551" x2="169.4209" y1="538.2578" y2="538.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.4658" x="50.9551" y="533.1919">Redirect to login</text></g><path d="M461,558.2578 L461,613.2578 L626,613.2578 L626,568.2578 L616,558.2578 L461,558.2578" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M616,558.2578 L616,568.2578 L626,568.2578 L616,558.2578" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.0737" x="467" y="575.3247">Circuit breaker:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.1299" x="467" y="590.4575">After 5 failures in 30s,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.3252" x="467" y="605.5903">fail-fast for 60s</text><!--SRC=[NLBBajCm4BphAxhsJ6h3yv03LMQBWWKsoP9TBXG7sPuuKn6IaSOnuSH7y8Ly2IF7IIKSDVsOLajfoxwrqNv7QQjj4qFdwvlWGaI_OI6JJdYY7ntvYkue9TjGuRZngCWBnJDMfDG6duwiD-H2NyGOUaZio1XXSOIlAnNQoE4R_lx-WxTAY7XlVUtODyROIlJycDHPNOKhRgqNNDs5abLTjEqLR89jsqkyMDxYdHNgxNuWDFr_U2SRh2ZkkAA3WmukAIEAOi3JhZAr5LlQHBXQXYHDfDNzfm6iIsDoHanUvoWpt7eMrlNgMma7RtIQmQQVORbOFU3QjdmzOgRf1w4ccE6BTQnx21AsfBgSSp8gNqoVuY6FGJzRZbHhFqx6KQIrDhw1tLbsjdHaW7FZpoD-y0Kkd9zDfvXJVm8FGhrpradSesTb-pE6OfbIbpFSTnJtEghBmMzKfSx9aNUsPV5nj3zMzM6rcEU_akdajDnvEDtbFCwHdqjuz3bzYFnBEm26SXNFJv1NrzfD9Qg62mrxGrwRya5BZTni165zU6xWXcFLiQ2CPBSgrb6nrc-CbrXhZPsc07iydwOd2kNHP6sJOAsVyjKqPMTauty0]--></g></svg>